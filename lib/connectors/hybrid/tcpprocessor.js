"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils = require("../../util/utils");
const tcpsocket_1 = require("./tcpsocket");
const events_1 = require("events");
var State;
(function (State) {
    State[State["ST_STARTED"] = 1] = "ST_STARTED";
    State[State["ST_CLOSED"] = 2] = "ST_CLOSED";
})(State || (State = {}));
// private protocol, no need exports
const HEAD_SIZE = 4;
class TCPProcessor extends events_1.EventEmitter {
    constructor(closeMethod) {
        super();
        this.closeMethod = closeMethod;
        this.state = State.ST_STARTED;
    }
    add(socket, data) {
        if (this.state !== State.ST_STARTED) {
            return;
        }
        let tcpsocket = new tcpsocket_1.default(socket, {
            headSize: HEAD_SIZE,
            headHandler: utils.headHandler,
            closeMethod: this.closeMethod
        });
        this.emit("connection", tcpsocket);
        socket.emit("data", data);
    }
    close() {
        if (this.state !== State.ST_STARTED) {
            return;
        }
        this.state = State.ST_CLOSED;
    }
}
exports.default = TCPProcessor;
exports.TCPProcessor = TCPProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGNwcHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGNwcHJvY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsMENBQTJDO0FBQzNDLDJDQUFvQztBQUNwQyxtQ0FBc0M7QUFHdEMsSUFBSyxLQUdKO0FBSEQsV0FBSyxLQUFLO0lBQ1IsNkNBQWMsQ0FBQTtJQUNkLDJDQUFhLENBQUE7QUFDZixDQUFDLEVBSEksS0FBSyxLQUFMLEtBQUssUUFHVDtBQUVELG9DQUFvQztBQUNwQyxNQUFNLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFFcEIsa0JBQWtDLFNBQVEscUJBQVk7SUFFcEQsWUFBb0IsV0FBbUI7UUFDckMsS0FBSyxFQUFFLENBQUM7UUFEVSxnQkFBVyxHQUFYLFdBQVcsQ0FBUTtRQUVyQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUM7SUFDaEMsQ0FBQztJQUVELEdBQUcsQ0FBQyxNQUFjLEVBQUUsSUFBUztRQUMzQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQztRQUNULENBQUM7UUFDRCxJQUFJLFNBQVMsR0FBRyxJQUFJLG1CQUFTLENBQUMsTUFBTSxFQUFFO1lBQ3BDLFFBQVEsRUFBRSxTQUFTO1lBQ25CLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztZQUM5QixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7U0FDOUIsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELEtBQUs7UUFDSCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQztRQUNULENBQUM7UUFDRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7SUFDL0IsQ0FBQztDQUNGO0FBMUJELCtCQTBCQztBQUVPLG9DQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcbmltcG9ydCB1dGlscyA9IHJlcXVpcmUoXCIuLi8uLi91dGlsL3V0aWxzXCIpO1xuaW1wb3J0IFRjcFNvY2tldCBmcm9tICcuL3RjcHNvY2tldCc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tIFwiZXZlbnRzXCI7XG5pbXBvcnQgeyBTb2NrZXQgfSBmcm9tIFwibmV0XCI7XG5cbmVudW0gU3RhdGUge1xuICBTVF9TVEFSVEVEID0gMSxcbiAgU1RfQ0xPU0VEID0gMlxufVxuXG4vLyBwcml2YXRlIHByb3RvY29sLCBubyBuZWVkIGV4cG9ydHNcbmNvbnN0IEhFQURfU0laRSA9IDQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRDUFByb2Nlc3NvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgc3RhdGU6IFN0YXRlO1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNsb3NlTWV0aG9kOiBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuc3RhdGUgPSBTdGF0ZS5TVF9TVEFSVEVEO1xuICB9XG5cbiAgYWRkKHNvY2tldDogU29ja2V0LCBkYXRhOiBhbnkpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPT0gU3RhdGUuU1RfU1RBUlRFRCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgdGNwc29ja2V0ID0gbmV3IFRjcFNvY2tldChzb2NrZXQsIHtcbiAgICAgIGhlYWRTaXplOiBIRUFEX1NJWkUsXG4gICAgICBoZWFkSGFuZGxlcjogdXRpbHMuaGVhZEhhbmRsZXIsXG4gICAgICBjbG9zZU1ldGhvZDogdGhpcy5jbG9zZU1ldGhvZFxuICAgIH0pO1xuICAgIHRoaXMuZW1pdChcImNvbm5lY3Rpb25cIiwgdGNwc29ja2V0KTtcbiAgICBzb2NrZXQuZW1pdChcImRhdGFcIiwgZGF0YSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPT0gU3RhdGUuU1RfU1RBUlRFRCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnN0YXRlID0gU3RhdGUuU1RfQ0xPU0VEO1xuICB9XG59XG5cbmV4cG9ydCB7VENQUHJvY2Vzc29yfSJdfQ==