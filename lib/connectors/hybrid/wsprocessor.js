"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const http_1 = require("http");
const ws_1 = require("ws");
const events_1 = require("events");
class WSProcessor extends events_1.EventEmitter {
    constructor() {
        super();
        this.httpServer = new http_1.Server();
        this.wsServer = new ws_1.Server({ server: this.httpServer });
        this.wsServer.on("connection", socket => {
            this.emit("connection", socket);
        });
        this.state = 1 /* ST_STARTED */;
    }
    add(socket, data) {
        if (this.state != 1 /* ST_STARTED */) {
            return;
        }
        this.httpServer.emit("connection", socket);
        socket.emit("data", data);
    }
    close() {
        if (this.state != 1 /* ST_STARTED */) {
            return;
        }
        this.state = 2 /* ST_CLOSED */;
        this.wsServer.close();
        delete this.wsServer;
        delete this.httpServer;
    }
}
exports.default = WSProcessor;
exports.WSProcessor = WSProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid3Nwcm9jZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3c3Byb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUE0QztBQUM1QywyQkFBK0M7QUFFL0MsbUNBQXNDO0FBUXRDLGlCQUFpQyxTQUFRLHFCQUFZO0lBSW5EO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksYUFBVSxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFdBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUVqRSxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsS0FBSyxxQkFBbUIsQ0FBQztJQUNoQyxDQUFDO0lBRUQsR0FBRyxDQUFDLE1BQWMsRUFBRSxJQUFTO1FBQzNCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLHNCQUFvQixDQUFDLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUM7UUFDVCxDQUFDO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxLQUFLO1FBQ0gsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssc0JBQW9CLENBQUMsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQztRQUNULENBQUM7UUFFRCxJQUFJLENBQUMsS0FBSyxvQkFBa0IsQ0FBQztRQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztDQUNGO0FBbENELDhCQWtDQztBQUVRLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyIGFzIEh0dHBTZXJ2ZXIgfSBmcm9tIFwiaHR0cFwiO1xuaW1wb3J0IHsgU2VydmVyIGFzIFdlYlNvY2tldFNlcnZlciB9IGZyb20gXCJ3c1wiO1xuaW1wb3J0IHsgU29ja2V0IH0gZnJvbSBcIm5ldFwiO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xuaW1wb3J0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcblxuY29uc3QgZW51bSBTdGF0ZSB7XG4gIFNUX1NUQVJURUQgPSAxLFxuICBTVF9DTE9TRUQgPSAyXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdTUHJvY2Vzc29yIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcHJpdmF0ZSBzdGF0ZTogU3RhdGU7XG4gIHByaXZhdGUgaHR0cFNlcnZlcjogSHR0cFNlcnZlcjtcbiAgcHJpdmF0ZSB3c1NlcnZlcjogV2ViU29ja2V0U2VydmVyO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuaHR0cFNlcnZlciA9IG5ldyBIdHRwU2VydmVyKCk7XG4gICAgdGhpcy53c1NlcnZlciA9IG5ldyBXZWJTb2NrZXRTZXJ2ZXIoeyBzZXJ2ZXI6IHRoaXMuaHR0cFNlcnZlciB9KTtcblxuICAgIHRoaXMud3NTZXJ2ZXIub24oXCJjb25uZWN0aW9uXCIsIHNvY2tldCA9PiB7XG4gICAgICB0aGlzLmVtaXQoXCJjb25uZWN0aW9uXCIsIHNvY2tldCk7XG4gICAgfSk7XG4gICAgdGhpcy5zdGF0ZSA9IFN0YXRlLlNUX1NUQVJURUQ7XG4gIH1cblxuICBhZGQoc29ja2V0OiBTb2NrZXQsIGRhdGE6IGFueSkge1xuICAgIGlmICh0aGlzLnN0YXRlICE9IFN0YXRlLlNUX1NUQVJURUQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmh0dHBTZXJ2ZXIuZW1pdChcImNvbm5lY3Rpb25cIiwgc29ja2V0KTtcbiAgICBzb2NrZXQuZW1pdChcImRhdGFcIiwgZGF0YSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPSBTdGF0ZS5TVF9TVEFSVEVEKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZSA9IFN0YXRlLlNUX0NMT1NFRDtcbiAgICB0aGlzLndzU2VydmVyLmNsb3NlKCk7XG4gICAgZGVsZXRlIHRoaXMud3NTZXJ2ZXI7XG4gICAgZGVsZXRlIHRoaXMuaHR0cFNlcnZlcjtcbiAgfVxufVxuXG5leHBvcnQgeyBXU1Byb2Nlc3NvciB9O1xuIl19