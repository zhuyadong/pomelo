"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const http_1 = require("http");
const ws_1 = require("ws");
const events_1 = require("events");
class WSProcessor extends events_1.EventEmitter {
    constructor() {
        super();
        this.httpServer = new http_1.Server();
        this.wsServer = new ws_1.Server({ server: this.httpServer });
        this.wsServer.on("connection", socket => {
            this.emit("connection", socket);
        });
        this.state = 1 /* ST_STARTED */;
    }
    add(socket, data) {
        if (this.state != 1 /* ST_STARTED */) {
            return;
        }
        this.httpServer.emit("connection", socket);
        socket.emit("data", data);
    }
    close() {
        if (this.state != 1 /* ST_STARTED */) {
            return;
        }
        this.state = 2 /* ST_CLOSED */;
        this.wsServer.close();
        delete this.wsServer;
        delete this.httpServer;
    }
}
exports.default = WSProcessor;
exports.WSProcessor = WSProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid3Nwcm9jZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3c3Byb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUE0QztBQUM1QywyQkFBK0M7QUFFL0MsbUNBQXNDO0FBUXRDLGlCQUFpQyxTQUFRLHFCQUFZO0lBSW5EO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksYUFBVSxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFdBQWUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUVqRSxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsS0FBSyxxQkFBbUIsQ0FBQztJQUNoQyxDQUFDO0lBRUQsR0FBRyxDQUFDLE1BQWMsRUFBRSxJQUFTO1FBQzNCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLHNCQUFvQixDQUFDLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUM7UUFDVCxDQUFDO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxLQUFLO1FBQ0gsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssc0JBQW9CLENBQUMsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQztRQUNULENBQUM7UUFFRCxJQUFJLENBQUMsS0FBSyxvQkFBa0IsQ0FBQztRQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztDQUNGO0FBbENELDhCQWtDQztBQUVRLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyIGFzIEh0dHBTZXJ2ZXIgfSBmcm9tIFwiaHR0cFwiO1xyXG5pbXBvcnQgeyBTZXJ2ZXIgYXMgV2ViU29ja2V0U2VydmVyIH0gZnJvbSBcIndzXCI7XHJcbmltcG9ydCB7IFNvY2tldCB9IGZyb20gXCJuZXRcIjtcclxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xyXG5pbXBvcnQgdXRpbCA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xyXG5cclxuY29uc3QgZW51bSBTdGF0ZSB7XHJcbiAgU1RfU1RBUlRFRCA9IDEsXHJcbiAgU1RfQ0xPU0VEID0gMlxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXU1Byb2Nlc3NvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgcHJpdmF0ZSBzdGF0ZTogU3RhdGU7XHJcbiAgcHJpdmF0ZSBodHRwU2VydmVyOiBIdHRwU2VydmVyO1xyXG4gIHByaXZhdGUgd3NTZXJ2ZXI6IFdlYlNvY2tldFNlcnZlcjtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmh0dHBTZXJ2ZXIgPSBuZXcgSHR0cFNlcnZlcigpO1xyXG4gICAgdGhpcy53c1NlcnZlciA9IG5ldyBXZWJTb2NrZXRTZXJ2ZXIoeyBzZXJ2ZXI6IHRoaXMuaHR0cFNlcnZlciB9KTtcclxuXHJcbiAgICB0aGlzLndzU2VydmVyLm9uKFwiY29ubmVjdGlvblwiLCBzb2NrZXQgPT4ge1xyXG4gICAgICB0aGlzLmVtaXQoXCJjb25uZWN0aW9uXCIsIHNvY2tldCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc3RhdGUgPSBTdGF0ZS5TVF9TVEFSVEVEO1xyXG4gIH1cclxuXHJcbiAgYWRkKHNvY2tldDogU29ja2V0LCBkYXRhOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlICE9IFN0YXRlLlNUX1NUQVJURUQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaHR0cFNlcnZlci5lbWl0KFwiY29ubmVjdGlvblwiLCBzb2NrZXQpO1xyXG4gICAgc29ja2V0LmVtaXQoXCJkYXRhXCIsIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZSAhPSBTdGF0ZS5TVF9TVEFSVEVEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnN0YXRlID0gU3RhdGUuU1RfQ0xPU0VEO1xyXG4gICAgdGhpcy53c1NlcnZlci5jbG9zZSgpO1xyXG4gICAgZGVsZXRlIHRoaXMud3NTZXJ2ZXI7XHJcbiAgICBkZWxldGUgdGhpcy5odHRwU2VydmVyO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgV1NQcm9jZXNzb3IgfTtcclxuIl19