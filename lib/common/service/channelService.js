"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("../..");
const utils_1 = require("../../util/utils");
const countDownLatch_1 = require("../../util/countDownLatch");
const logger = require("pomelo-logger").getLogger("pomelo", __filename);
var State;
(function (State) {
    State[State["ST_INITED"] = 0] = "ST_INITED";
    State[State["ST_DESTROYED"] = 1] = "ST_DESTROYED";
})(State || (State = {}));
class ChannelService {
    constructor(app, opts) {
        this.app = app;
        opts = opts || {};
        this._channels = {};
        this.name = '__channel__';
        this.prefix = opts.prefix;
        this.store = opts.store;
        this.broadcastFilter = opts.broadcastFilter;
        this.channelRemote = new __1.ChannelRemote(app);
    }
    get channels() {
        return this._channels;
    }
    start(cb) {
        restoreChannel(this, cb);
    }
    createChannel(name) {
        if (this._channels[name]) {
            return this._channels[name];
        }
        let c = new Channel(name, this);
        addToStore(this, genKey(this), genKey(this, name));
        this._channels[name] = c;
        return c;
    }
    getChannel(name, create) {
        let channel = this.channels[name];
        if (!channel && !!create) {
            channel = this.channels[name] = new Channel(name, this);
            addToStore(this, genKey(this), genKey(this, name));
        }
        return channel;
    }
    destroyChannel(name) {
        delete this.channels[name];
        removeFromStore(this, genKey(this), genKey(this, name));
        removeAllFromStore(this, genKey(this, name));
    }
    //TODO: 5?
    pushMessageByUids(route, msg, uids, opts, cb) {
        if (typeof route !== "string") {
            cb = opts;
            opts = uids;
            uids = msg;
            msg = route;
            route = msg.route;
        }
        if (!cb && typeof opts === "function") {
            cb = opts;
            opts = {};
        }
        if (!uids || uids.length === 0) {
            utils_1.invokeCallback(cb, new Error("uids should not be empty"));
            return;
        }
        let groups = {}, record;
        for (let i = 0, l = uids.length; i < l; i++) {
            record = uids[i];
            add(record.uid, record.sid, groups);
        }
        sendMessageByGroup(this, route, msg, groups, opts, cb);
    }
    broadcast(stype, route, msg, opts, cb) {
        let app = this.app;
        let namespace = "sys";
        let service = "channelRemote";
        let method = "broadcast";
        let servers = app.getServersByType(stype);
        if (!servers || servers.length === 0) {
            // server list is empty
            utils_1.invokeCallback(cb);
            return;
        }
        let count = servers.length;
        let successFlag = false;
        let latch = countDownLatch_1.createCountDownLatch(count, {}, () => {
            if (!successFlag) {
                utils_1.invokeCallback(cb, new Error("broadcast fails"));
                return;
            }
            utils_1.invokeCallback(cb, null);
        });
        let genCB = (serverId) => {
            return (err) => {
                if (err) {
                    logger.error("[broadcast] fail to push message to serverId: " +
                        serverId +
                        ", err:" +
                        err.stack);
                    latch.done();
                    return;
                }
                successFlag = true;
                latch.done();
            };
        };
        let self = this;
        let sendMessage = (serverId) => {
            return (() => {
                if (serverId === app.serverId) {
                    self.channelRemote[method](route, msg, opts, genCB());
                }
                else {
                    app.rpcInvoke(serverId, {
                        namespace: namespace,
                        service: service,
                        method: method,
                        args: [route, msg, opts]
                    }, genCB(serverId));
                }
            })();
        };
        opts = { type: "broadcast", userOptions: opts || {} };
        // for compatiblity
        opts.isBroadcast = true;
        if (opts.userOptions) {
            opts.binded = opts.userOptions.binded;
            opts.filterParam = opts.userOptions.filterParam;
        }
        for (let i = 0, l = count; i < l; i++) {
            sendMessage(servers[i].id);
        }
    }
}
exports.ChannelService = ChannelService;
class Channel {
    constructor(name, _channelService) {
        this.name = name;
        this._channelService = _channelService;
        this._groups = {};
        this._records = {};
        this._state = State.ST_INITED;
        this._userAmount = 0;
    }
    get userAmount() {
        return this._userAmount;
    }
    get groups() {
        return this._groups;
    }
    get records() {
        return this._records;
    }
    get channelService() {
        return this._channelService;
    }
    add(uid, sid) {
        if (this._state > State.ST_INITED) {
            return false;
        }
        else {
            let res = add(uid, sid, this._groups);
            if (res) {
                this._records[uid] = { sid: sid, uid: uid };
                ++this._userAmount;
            }
            addToStore(this._channelService, genKey(this._channelService, this.name), genValue(sid, uid));
            return res;
        }
    }
    leave(uid, sid) {
        if (!uid || !sid) {
            return false;
        }
        let res = deleteFrom(uid, sid, this.groups[sid]);
        if (res) {
            delete this._records[uid];
            --this._userAmount;
        }
        if (this.userAmount < 0)
            this._userAmount = 0; //robust
        removeFromStore(this._channelService, genKey(this._channelService, this.name), genValue(sid, uid));
        if (this.groups[sid] && this.groups[sid].length === 0) {
            delete this._groups[sid];
        }
        return res;
    }
    getMembers() {
        let res = [], groups = this.groups;
        let group, i, l;
        for (let sid in groups) {
            group = groups[sid];
            for (i = 0, l = group.length; i < l; i++) {
                res.push(group[i]);
            }
        }
        return res;
    }
    getMember(uid) {
        return this._records[uid];
    }
    destroy() {
        this._state = State.ST_DESTROYED;
        this._channelService.destroyChannel(this.name);
    }
    //TODO:4?
    pushMessage(route, msg, opts, cb) {
        if (this._state !== State.ST_INITED) {
            utils_1.invokeCallback(cb, new Error('channel is not running now'));
            return;
        }
        if (typeof route !== 'string') {
            cb = opts;
            opts = msg;
            msg = route;
            route = msg.route;
        }
        if (!cb && typeof opts === 'function') {
            cb = opts;
            opts = {};
        }
        sendMessageByGroup(this._channelService, route, msg, this.groups, opts, cb);
    }
}
exports.Channel = Channel;
function add(uid, sid, groups) {
    if (!sid) {
        logger.warn("ignore uid %j for sid not specified.", uid);
        return false;
    }
    let group = groups[sid];
    if (!group) {
        group = [];
        groups[sid] = group;
    }
    group.push(uid);
    return true;
}
function deleteFrom(uid, sid, group) {
    if (!uid || !sid || !group) {
        return false;
    }
    for (let i = 0, l = group.length; i < l; i++) {
        if (group[i] === uid) {
            group.splice(i, 1);
            return true;
        }
    }
    return false;
}
function sendMessageByGroup(channelService, route, msg, groups, opts, cb) {
    let app = channelService.app;
    let namespace = "sys";
    let service = "channelRemote";
    let method = "pushMessage";
    let count = utils_1.size(groups);
    let successFlag = false;
    let failIds = [];
    logger.debug("[%s] channelService sendMessageByGroup route: %s, msg: %j, groups: %j, opts: %j", app.serverId, route, msg, groups, opts);
    if (count === 0) {
        // group is empty
        utils_1.invokeCallback(cb);
        return;
    }
    let latch = countDownLatch_1.createCountDownLatch(count, {}, () => {
        if (!successFlag) {
            utils_1.invokeCallback(cb, new Error("all uids push message fail"));
            return;
        }
        utils_1.invokeCallback(cb, null, failIds);
    });
    let rpcCB = (serverId) => {
        return (err, fails) => {
            if (err) {
                logger.error("[pushMessage] fail to dispatch msg to serverId: " +
                    serverId +
                    ", err:" +
                    err.stack);
                latch.done();
                return;
            }
            if (fails) {
                failIds = failIds.concat(fails);
            }
            successFlag = true;
            latch.done();
        };
    };
    opts = { type: "push", userOptions: opts || {} };
    // for compatiblity
    opts.isPush = true;
    let sendMessage = (sid) => {
        return (() => {
            if (sid === app.serverId) {
                channelService.channelRemote[method](route, msg, groups[sid], opts, rpcCB(sid));
            }
            else {
                app.rpcInvoke(sid, {
                    namespace: namespace,
                    service: service,
                    method: method,
                    args: [route, msg, groups[sid], opts]
                }, rpcCB(sid));
            }
        })();
    };
    let group;
    for (let sid in groups) {
        group = groups[sid];
        if (group && group.length > 0) {
            sendMessage(sid);
        }
        else {
            // empty group
            process.nextTick(rpcCB(sid));
        }
    }
}
function restoreChannel(self, cb) {
    if (!self.store) {
        utils_1.invokeCallback(cb);
        return;
    }
    else {
        loadAllFromStore(self, genKey(self), (err, list) => {
            if (!!err) {
                utils_1.invokeCallback(cb, err);
                return;
            }
            else {
                if (!list.length || !Array.isArray(list)) {
                    utils_1.invokeCallback(cb);
                    return;
                }
                let load = (key) => {
                    return (() => {
                        loadAllFromStore(self, key, (err, items) => {
                            for (let j = 0; j < items.length; j++) {
                                let array = items[j].split(":");
                                let sid = array[0];
                                let uid = array[1];
                                let channel = self.channels[name];
                                let res = add(uid, sid, channel.groups);
                                if (res) {
                                    channel.records[uid] = { sid: sid, uid: uid };
                                }
                            }
                        });
                    })();
                };
                for (let i = 0; i < list.length; i++) {
                    let name = list[i].slice(genKey(self).length + 1);
                    self.channels[name] = new Channel(name, self);
                    load(list[i]);
                }
                utils_1.invokeCallback(cb);
            }
        });
    }
}
function addToStore(self, key, value) {
    if (!!self.store) {
        self.store.add(key, value, (err) => {
            if (!!err) {
                logger.error("add key: %s value: %s to store, with err: %j", key, value, err.stack);
            }
        });
    }
}
function removeFromStore(self, key, value) {
    if (!!self.store) {
        self.store.remove(key, value, (err) => {
            if (!!err) {
                logger.error("remove key: %s value: %s from store, with err: %j", key, value, err.stack);
            }
        });
    }
}
function loadAllFromStore(self, key, cb) {
    if (!!self.store) {
        self.store.load(key, (err, list) => {
            if (!!err) {
                logger.error("load key: %s from store, with err: %j", key, err.stack);
                utils_1.invokeCallback(cb, err);
            }
            else {
                utils_1.invokeCallback(cb, null, list);
            }
        });
    }
}
function removeAllFromStore(self, key) {
    if (!!self.store) {
        self.store.removeAll(key, (err) => {
            if (!!err) {
                logger.error("remove key: %s all members from store, with err: %j", key, err.stack);
            }
        });
    }
}
function genKey(self, name) {
    if (!!name) {
        return self.prefix + ":" + self.app.serverId + ":" + name;
    }
    else {
        return self.prefix + ":" + self.app.serverId;
    }
}
function genValue(sid, uid) {
    return sid + ":" + uid;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbFNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFubmVsU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDZCQUFpRDtBQUVqRCw0Q0FBd0Q7QUFDeEQsOERBQWlFO0FBR2pFLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBRXhFLElBQUssS0FHSjtBQUhELFdBQUssS0FBSztJQUNSLDJDQUFhLENBQUE7SUFDYixpREFBZ0IsQ0FBQTtBQUNsQixDQUFDLEVBSEksS0FBSyxLQUFMLEtBQUssUUFHVDtBQXVCRDtJQVVFLFlBQTRCLEdBQWdCLEVBQUUsSUFBd0I7UUFBMUMsUUFBRyxHQUFILEdBQUcsQ0FBYTtRQUMxQyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxHQUFHLGFBQWEsQ0FBQztRQUMxQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUM1QyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksaUJBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBWEQsSUFBSSxRQUFRO1FBQ1YsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQVdELEtBQUssQ0FBQyxFQUFhO1FBQ2pCLGNBQWMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELGFBQWEsQ0FBQyxJQUFZO1FBQ3hCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMs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QXFELEVBQ3JELEdBQUcsRUFDSCxHQUFHLENBQUMsS0FBSyxDQUNWLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQztBQUVELGdCQUFnQixJQUFvQixFQUFFLElBQWE7SUFDakQsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDWCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQztJQUM1RCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUM7SUFDL0MsQ0FBQztBQUNILENBQUM7QUFFRCxrQkFBa0IsR0FBVyxFQUFFLEdBQVc7SUFDeEMsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO0FBQ3pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25zdGFudHMgfSBmcm9tIFwib3NcIjtcbmltcG9ydCB7IENvbXBvbmVudCwgQ2hhbm5lbFJlbW90ZSB9IGZyb20gXCIuLi8uLlwiO1xuaW1wb3J0IHsgQXBwbGljYXRpb24gfSBmcm9tIFwiLi4vLi4vYXBwbGljYXRpb25cIjtcbmltcG9ydCB7IGludm9rZUNhbGxiYWNrLCBzaXplIH0gZnJvbSBcIi4uLy4uL3V0aWwvdXRpbHNcIjtcbmltcG9ydCB7IGNyZWF0ZUNvdW50RG93bkxhdGNoIH0gZnJvbSBcIi4uLy4uL3V0aWwvY291bnREb3duTGF0Y2hcIjtcbmltcG9ydCB7IFNlc3Npb24gfSBmcm9tIFwiLi9zZXNzaW9uU2VydmljZVwiO1xuXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKFwicG9tZWxvLWxvZ2dlclwiKS5nZXRMb2dnZXIoXCJwb21lbG9cIiwgX19maWxlbmFtZSk7XG5cbmVudW0gU3RhdGUge1xuICBTVF9JTklURUQgPSAwLFxuICBTVF9ERVNUUk9ZRUQgPSAxXG59XG5cbmV4cG9ydCB0eXBlIEJyb2FkY2FzdEZpbHRlciA9IChcbiAgc2Vzc2lvbjogU2Vzc2lvbixcbiAgbXNnOiBhbnksXG4gIG9wdHM6IHsgZmlsdGVyUGFyYW06IGFueSB9XG4pID0+IGJvb2xlYW47XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhbm5lbFNlcnZpY2VPcHRzIHtcbiAgcHJlZml4OiBzdHJpbmc7XG4gIHN0b3JlOiBDaGFubmVsU3RvcmU7XG4gIGJyb2FkY2FzdEZpbHRlcjogQnJvYWRjYXN0RmlsdGVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYW5uZWxTdG9yZSB7XG4gIGFkZChrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgY2I/OiBGdW5jdGlvbik6IHZvaWQ7XG4gIHJlbW92ZShrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgY2I/OiBGdW5jdGlvbik6IHZvaWQ7XG4gIGxvYWQoa2V5OiBzdHJpbmcsIGNiPzogRnVuY3Rpb24pOiB2b2lkO1xuICByZW1vdmVBbGwoa2V5OiBzdHJpbmcsIGNiPzogRnVuY3Rpb24pOiB2b2lkO1xufVxuXG5leHBvcnQgdHlwZSBDaGFubmVsTWFwID0geyBbaWR4OiBzdHJpbmddOiBDaGFubmVsIH07XG5cbmV4cG9ydCBjbGFzcyBDaGFubmVsU2VydmljZSBpbXBsZW1lbnRzIENvbXBvbmVudCB7XG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgcHJlZml4OiBzdHJpbmc7XG4gIHJlYWRvbmx5IHN0b3JlOiBDaGFubmVsU3RvcmU7XG4gIHJlYWRvbmx5IGNoYW5uZWxSZW1vdGU6IENoYW5uZWxSZW1vdGU7XG4gIHJlYWRvbmx5IGJyb2FkY2FzdEZpbHRlcjogQnJvYWRjYXN0RmlsdGVyO1xuICBwcml2YXRlIF9jaGFubmVsczogQ2hhbm5lbE1hcDtcbiAgZ2V0IGNoYW5uZWxzKCkge1xuICAgIHJldHVybiB0aGlzLl9jaGFubmVscztcbiAgfVxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVhZG9ubHkgYXBwOiBBcHBsaWNhdGlvbiwgb3B0czogQ2hhbm5lbFNlcnZpY2VPcHRzKSB7XG4gICAgb3B0cyA9IG9wdHMgfHwge307XG4gICAgdGhpcy5fY2hhbm5lbHMgPSB7fTtcbiAgICB0aGlzLm5hbWUgPSAnX19jaGFubmVsX18nO1xuICAgIHRoaXMucHJlZml4ID0gb3B0cy5wcmVmaXg7XG4gICAgdGhpcy5zdG9yZSA9IG9wdHMuc3RvcmU7XG4gICAgdGhpcy5icm9hZGNhc3RGaWx0ZXIgPSBvcHRzLmJyb2FkY2FzdEZpbHRlcjtcbiAgICB0aGlzLmNoYW5uZWxSZW1vdGUgPSBuZXcgQ2hhbm5lbFJlbW90ZShhcHApO1xuICB9XG5cbiAgc3RhcnQoY2I/OiBGdW5jdGlvbikge1xuICAgIHJlc3RvcmVDaGFubmVsKHRoaXMsIGNiKTtcbiAgfVxuXG4gIGNyZWF0ZUNoYW5uZWwobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuX2NoYW5uZWxzW25hbWVdKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY2hhbm5lbHNbbmFtZV07XG4gICAgfVxuXG4gICAgbGV0IGMgPSBuZXcgQ2hhbm5lbChuYW1lLCB0aGlzKTtcbiAgICBhZGRUb1N0b3JlKHRoaXMsIGdlbktleSh0aGlzKSwgZ2VuS2V5KHRoaXMsIG5hbWUpKTtcbiAgICB0aGlzLl9jaGFubmVsc1tuYW1lXSA9IGM7XG4gICAgcmV0dXJuIGM7XG4gIH1cblxuICBnZXRDaGFubmVsKG5hbWU6IHN0cmluZywgY3JlYXRlPzogYm9vbGVhbikge1xuICAgIGxldCBjaGFubmVsID0gdGhpcy5jaGFubmVsc1tuYW1lXTtcbiAgICBpZiAoIWNoYW5uZWwgJiYgISFjcmVhdGUpIHtcbiAgICAgIGNoYW5uZWwgPSB0aGlzLmNoYW5uZWxzW25hbWVdID0gbmV3IENoYW5uZWwobmFtZSwgdGhpcyk7XG4gICAgICBhZGRUb1N0b3JlKHRoaXMsIGdlbktleSh0aGlzKSwgZ2VuS2V5KHRoaXMsIG5hbWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIGNoYW5uZWw7XG4gIH1cblxuICBkZXN0cm95Q2hhbm5lbChuYW1lOiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5jaGFubmVsc1tuYW1lXTtcbiAgICByZW1vdmVGcm9tU3RvcmUodGhpcywgZ2VuS2V5KHRoaXMpLCBnZW5LZXkodGhpcywgbmFtZSkpO1xuICAgIHJlbW92ZUFsbEZyb21TdG9yZSh0aGlzLCBnZW5LZXkodGhpcywgbmFtZSkpO1xuICB9XG5cbiAgLy9UT0RPOiA1P1xuICBwdXNoTWVzc2FnZUJ5VWlkcyhcbiAgICByb3V0ZT86IHN0cmluZyxcbiAgICBtc2c/OiBhbnksXG4gICAgdWlkcz86IENoYW5uZWxNZW1iZXJbXSxcbiAgICBvcHRzPzogYW55LFxuICAgIGNiPzogRnVuY3Rpb25cbiAgKSB7XG4gICAgaWYgKHR5cGVvZiByb3V0ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgY2IgPSBvcHRzO1xuICAgICAgb3B0cyA9IHVpZHM7XG4gICAgICB1aWRzID0gbXNnO1xuICAgICAgbXNnID0gcm91dGU7XG4gICAgICByb3V0ZSA9IG1zZy5yb3V0ZTtcbiAgICB9XG5cbiAgICBpZiAoIWNiICYmIHR5cGVvZiBvcHRzID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNiID0gb3B0cztcbiAgICAgIG9wdHMgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAoIXVpZHMgfHwgdWlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGludm9rZUNhbGxiYWNrKGNiISwgbmV3IEVycm9yKFwidWlkcyBzaG91bGQgbm90IGJlIGVtcHR5XCIpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGdyb3VwcyA9IHt9LFxuICAgICAgcmVjb3JkO1xuICAgIGZvciAobGV0IGkgPSAwLCBsID0gdWlkcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHJlY29yZCA9IHVpZHNbaV07XG4gICAgICBhZGQocmVjb3JkLnVpZCwgcmVjb3JkLnNpZCwgZ3JvdXBzKTtcbiAgICB9XG5cbiAgICBzZW5kTWVzc2FnZUJ5R3JvdXAodGhpcywgcm91dGUhLCBtc2csIGdyb3Vwcywgb3B0cywgY2IpO1xuICB9XG5cbiAgYnJvYWRjYXN0KHN0eXBlOiBzdHJpbmcsIHJvdXRlOiBzdHJpbmcsIG1zZzogYW55LCBvcHRzPzogYW55LCBjYj86IEZ1bmN0aW9uKSB7XG4gICAgbGV0IGFwcCA9IHRoaXMuYXBwO1xuICAgIGxldCBuYW1lc3BhY2UgPSBcInN5c1wiO1xuICAgIGxldCBzZXJ2aWNlID0gXCJjaGFubmVsUmVtb3RlXCI7XG4gICAgbGV0IG1ldGhvZCA9IFwiYnJvYWRjYXN0XCI7XG4gICAgbGV0IHNlcnZlcnMgPSBhcHAuZ2V0U2VydmVyc0J5VHlwZShzdHlwZSk7XG5cbiAgICBpZiAoIXNlcnZlcnMgfHwgc2VydmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIHNlcnZlciBsaXN0IGlzIGVtcHR5XG4gICAgICBpbnZva2VDYWxsYmFjayhjYiEpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBjb3VudCA9IHNlcnZlcnMubGVuZ3RoO1xuICAgIGxldCBzdWNjZXNzRmxhZyA9IGZhbHNlO1xuXG4gICAgbGV0IGxhdGNoID0gY3JlYXRlQ291bnREb3duTGF0Y2goY291bnQsIHt9LCAoKSA9PiB7XG4gICAgICBpZiAoIXN1Y2Nlc3NGbGFnKSB7XG4gICAgICAgIGludm9rZUNhbGxiYWNrKGNiISwgbmV3IEVycm9yKFwiYnJvYWRjYXN0IGZhaWxzXCIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW52b2tlQ2FsbGJhY2soY2IhLCBudWxsKTtcbiAgICB9KTtcblxuICAgIGxldCBnZW5DQiA9IChzZXJ2ZXJJZD86IHN0cmluZykgPT4ge1xuICAgICAgcmV0dXJuIChlcnI6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgXCJbYnJvYWRjYXN0XSBmYWlsIHRvIHB1c2ggbWVzc2FnZSB0byBzZXJ2ZXJJZDogXCIgK1xuICAgICAgICAgICAgICBzZXJ2ZXJJZCArXG4gICAgICAgICAgICAgIFwiLCBlcnI6XCIgK1xuICAgICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICApO1xuICAgICAgICAgIGxhdGNoLmRvbmUoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc3VjY2Vzc0ZsYWcgPSB0cnVlO1xuICAgICAgICBsYXRjaC5kb25lKCk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IHNlbmRNZXNzYWdlID0gKHNlcnZlcklkOiBzdHJpbmcpID0+IHtcbiAgICAgIHJldHVybiAoKCkgPT4ge1xuICAgICAgICBpZiAoc2VydmVySWQgPT09IGFwcC5zZXJ2ZXJJZCkge1xuICAgICAgICAgICg8YW55PnNlbGYpLmNoYW5uZWxSZW1vdGVbbWV0aG9kXShyb3V0ZSwgbXNnLCBvcHRzLCBnZW5DQigpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhcHAucnBjSW52b2tlKFxuICAgICAgICAgICAgc2VydmVySWQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlLFxuICAgICAgICAgICAgICBzZXJ2aWNlOiBzZXJ2aWNlLFxuICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICAgICAgICAgICAgYXJnczogW3JvdXRlLCBtc2csIG9wdHNdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2VuQ0Ioc2VydmVySWQpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9O1xuXG4gICAgb3B0cyA9IHsgdHlwZTogXCJicm9hZGNhc3RcIiwgdXNlck9wdGlvbnM6IG9wdHMgfHwge30gfTtcblxuICAgIC8vIGZvciBjb21wYXRpYmxpdHlcbiAgICBvcHRzLmlzQnJvYWRjYXN0ID0gdHJ1ZTtcbiAgICBpZiAob3B0cy51c2VyT3B0aW9ucykge1xuICAgICAgb3B0cy5iaW5kZWQgPSBvcHRzLnVzZXJPcHRpb25zLmJpbmRlZDtcbiAgICAgIG9wdHMuZmlsdGVyUGFyYW0gPSBvcHRzLnVzZXJPcHRpb25zLmZpbHRlclBhcmFtO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gY291bnQ7IGkgPCBsOyBpKyspIHtcbiAgICAgIHNlbmRNZXNzYWdlKHNlcnZlcnNbaV0uaWQpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgdHlwZSBDaGFubmVsR3JvdXBNYXAgPSB7IFtpZDogc3RyaW5nXTogc3RyaW5nW10gfTtcbmV4cG9ydCBpbnRlcmZhY2UgQ2hhbm5lbE1lbWJlciB7XG4gIHNpZDogc3RyaW5nO1xuICB1aWQ6IHN0cmluZztcbn1cbmV4cG9ydCB0eXBlIENoYW5uZWxNZW1iZXJNYXAgPSB7IFtpZDogc3RyaW5nXTogQ2hhbm5lbE1lbWJlciB9O1xuXG5leHBvcnQgY2xhc3MgQ2hhbm5lbCB7XG4gIHByaXZhdGUgX3N0YXRlOiBTdGF0ZTtcblxuICBwcml2YXRlIF91c2VyQW1vdW50OiBudW1iZXI7XG4gIGdldCB1c2VyQW1vdW50KCkge1xuICAgIHJldHVybiB0aGlzLl91c2VyQW1vdW50O1xuICB9XG5cbiAgcHJpdmF0ZSBfZ3JvdXBzOiBDaGFubmVsR3JvdXBNYXA7XG4gIGdldCBncm91cHMoKTogUmVhZG9ubHk8Q2hhbm5lbEdyb3VwTWFwPiB7XG4gICAgcmV0dXJuIHRoaXMuX2dyb3VwcztcbiAgfVxuXG4gIHByaXZhdGUgX3JlY29yZHM6IENoYW5uZWxNZW1iZXJNYXA7XG4gIGdldCByZWNvcmRzKCk6IFJlYWRvbmx5PENoYW5uZWxNZW1iZXJNYXA+IHtcbiAgICByZXR1cm4gdGhpcy5fcmVjb3JkcztcbiAgfVxuXG4gIGdldCBjaGFubmVsU2VydmljZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hhbm5lbFNlcnZpY2U7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcmVhZG9ubHkgbmFtZTogc3RyaW5nLFxuICAgIHByaXZhdGUgX2NoYW5uZWxTZXJ2aWNlOiBDaGFubmVsU2VydmljZVxuICApIHtcbiAgICB0aGlzLl9ncm91cHMgPSB7fTtcbiAgICB0aGlzLl9yZWNvcmRzID0ge307XG4gICAgdGhpcy5fc3RhdGUgPSBTdGF0ZS5TVF9JTklURUQ7XG4gICAgdGhpcy5fdXNlckFtb3VudCA9IDA7XG4gIH1cblxuICBhZGQodWlkOiBzdHJpbmcsIHNpZDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuX3N0YXRlID4gU3RhdGUuU1RfSU5JVEVEKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCByZXMgPSBhZGQodWlkLCBzaWQsIHRoaXMuX2dyb3Vwcyk7XG4gICAgICBpZiAocmVzKSB7XG4gICAgICAgIHRoaXMuX3JlY29yZHNbdWlkXSA9IHsgc2lkOiBzaWQsIHVpZDogdWlkIH07XG4gICAgICAgICsrdGhpcy5fdXNlckFtb3VudDtcbiAgICAgIH1cbiAgICAgIGFkZFRvU3RvcmUoXG4gICAgICAgIHRoaXMuX2NoYW5uZWxTZXJ2aWNlLFxuICAgICAgICBnZW5LZXkodGhpcy5fY2hhbm5lbFNlcnZpY2UsIHRoaXMubmFtZSksXG4gICAgICAgIGdlblZhbHVlKHNpZCwgdWlkKVxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICB9XG5cbiAgbGVhdmUodWlkOiBzdHJpbmcsIHNpZDogc3RyaW5nKSB7XG4gICAgaWYgKCF1aWQgfHwgIXNpZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsZXQgcmVzID0gZGVsZXRlRnJvbSh1aWQsIHNpZCwgdGhpcy5ncm91cHNbc2lkXSk7XG4gICAgaWYgKHJlcykge1xuICAgICAgZGVsZXRlIHRoaXMuX3JlY29yZHNbdWlkXTtcbiAgICAgIC0tdGhpcy5fdXNlckFtb3VudDtcbiAgICB9XG4gICAgaWYgKHRoaXMudXNlckFtb3VudCA8IDApIHRoaXMuX3VzZXJBbW91bnQgPSAwOyAvL3JvYnVzdFxuICAgIHJlbW92ZUZyb21TdG9yZShcbiAgICAgIHRoaXMuX2NoYW5uZWxTZXJ2aWNlLFxuICAgICAgZ2VuS2V5KHRoaXMuX2NoYW5uZWxTZXJ2aWNlLCB0aGlzLm5hbWUpLFxuICAgICAgZ2VuVmFsdWUoc2lkLCB1aWQpXG4gICAgKTtcbiAgICBpZiAodGhpcy5ncm91cHNbc2lkXSAmJiB0aGlzLmdyb3Vwc1tzaWRdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZGVsZXRlIHRoaXMuX2dyb3Vwc1tzaWRdO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgZ2V0TWVtYmVycygpIHtcbiAgICBsZXQgcmVzID0gW10sXG4gICAgICBncm91cHMgPSB0aGlzLmdyb3VwcztcbiAgICBsZXQgZ3JvdXAsIGksIGw7XG4gICAgZm9yIChsZXQgc2lkIGluIGdyb3Vwcykge1xuICAgICAgZ3JvdXAgPSBncm91cHNbc2lkXTtcbiAgICAgIGZvciAoaSA9IDAsIGwgPSBncm91cC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgcmVzLnB1c2goZ3JvdXBbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgZ2V0TWVtYmVyKHVpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlY29yZHNbdWlkXTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5fc3RhdGUgPSBTdGF0ZS5TVF9ERVNUUk9ZRUQ7XG4gICAgdGhpcy5fY2hhbm5lbFNlcnZpY2UuZGVzdHJveUNoYW5uZWwodGhpcy5uYW1lKTtcbiAgfVxuXG4gIC8vVE9ETzo0P1xuICBwdXNoTWVzc2FnZShyb3V0ZT86c3RyaW5nLCBtc2c/OmFueSwgb3B0cz86YW55LCBjYj86RnVuY3Rpb24pIHtcbiAgaWYodGhpcy5fc3RhdGUgIT09IFN0YXRlLlNUX0lOSVRFRCkge1xuICAgIGludm9rZUNhbGxiYWNrKGNiISwgbmV3IEVycm9yKCdjaGFubmVsIGlzIG5vdCBydW5uaW5nIG5vdycpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZih0eXBlb2Ygcm91dGUgIT09ICdzdHJpbmcnKSB7XG4gICAgY2IgPSBvcHRzO1xuICAgIG9wdHMgPSBtc2c7XG4gICAgbXNnID0gcm91dGU7XG4gICAgcm91dGUgPSBtc2cucm91dGU7XG4gIH1cblxuICBpZighY2IgJiYgdHlwZW9mIG9wdHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYiA9IG9wdHM7XG4gICAgb3B0cyA9IHt9O1xuICB9XG5cbiAgc2VuZE1lc3NhZ2VCeUdyb3VwKHRoaXMuX2NoYW5uZWxTZXJ2aWNlLCByb3V0ZSEsIG1zZywgdGhpcy5ncm91cHMsIG9wdHMsIGNiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGQodWlkOiBzdHJpbmcsIHNpZDogc3RyaW5nLCBncm91cHM6IENoYW5uZWxHcm91cE1hcCkge1xuICBpZiAoIXNpZCkge1xuICAgIGxvZ2dlci53YXJuKFwiaWdub3JlIHVpZCAlaiBmb3Igc2lkIG5vdCBzcGVjaWZpZWQuXCIsIHVpZCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbGV0IGdyb3VwID0gZ3JvdXBzW3NpZF07XG4gIGlmICghZ3JvdXApIHtcbiAgICBncm91cCA9IFtdO1xuICAgIGdyb3Vwc1tzaWRdID0gZ3JvdXA7XG4gIH1cblxuICBncm91cC5wdXNoKHVpZCk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBkZWxldGVGcm9tKHVpZDogc3RyaW5nLCBzaWQ6IHN0cmluZywgZ3JvdXA6IHN0cmluZ1tdKSB7XG4gIGlmICghdWlkIHx8ICFzaWQgfHwgIWdyb3VwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBncm91cC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICBpZiAoZ3JvdXBbaV0gPT09IHVpZCkge1xuICAgICAgZ3JvdXAuc3BsaWNlKGksIDEpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBzZW5kTWVzc2FnZUJ5R3JvdXAoXG4gIGNoYW5uZWxTZXJ2aWNlOiBDaGFubmVsU2VydmljZSxcbiAgcm91dGU6IHN0cmluZyxcbiAgbXNnOiBhbnksXG4gIGdyb3VwczogQ2hhbm5lbEdyb3VwTWFwLFxuICBvcHRzOiBhbnksXG4gIGNiPzogRnVuY3Rpb25cbikge1xuICBsZXQgYXBwID0gY2hhbm5lbFNlcnZpY2UuYXBwO1xuICBsZXQgbmFtZXNwYWNlID0gXCJzeXNcIjtcbiAgbGV0IHNlcnZpY2UgPSBcImNoYW5uZWxSZW1vdGVcIjtcbiAgbGV0IG1ldGhvZCA9IFwicHVzaE1lc3NhZ2VcIjtcbiAgbGV0IGNvdW50ID0gc2l6ZShncm91cHMpO1xuICBsZXQgc3VjY2Vzc0ZsYWcgPSBmYWxzZTtcbiAgbGV0IGZhaWxJZHM6IHN0cmluZ1tdID0gW107XG5cbiAgbG9nZ2VyLmRlYnVnKFxuICAgIFwiWyVzXSBjaGFubmVsU2VydmljZSBzZW5kTWVzc2FnZUJ5R3JvdXAgcm91dGU6ICVzLCBtc2c6ICVqLCBncm91cHM6ICVqLCBvcHRzOiAlalwiLFxuICAgIGFwcC5zZXJ2ZXJJZCxcbiAgICByb3V0ZSxcbiAgICBtc2csXG4gICAgZ3JvdXBzLFxuICAgIG9wdHNcbiAgKTtcbiAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgLy8gZ3JvdXAgaXMgZW1wdHlcbiAgICBpbnZva2VDYWxsYmFjayhjYiEpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBsYXRjaCA9IGNyZWF0ZUNvdW50RG93bkxhdGNoKGNvdW50LCB7fSwgKCkgPT4ge1xuICAgIGlmICghc3VjY2Vzc0ZsYWcpIHtcbiAgICAgIGludm9rZUNhbGxiYWNrKGNiISwgbmV3IEVycm9yKFwiYWxsIHVpZHMgcHVzaCBtZXNzYWdlIGZhaWxcIikpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpbnZva2VDYWxsYmFjayhjYiEsIG51bGwsIGZhaWxJZHMpO1xuICB9KTtcblxuICBsZXQgcnBjQ0IgPSAoc2VydmVySWQ6IHN0cmluZykgPT4ge1xuICAgIHJldHVybiAoZXJyOiBhbnksIGZhaWxzOiBhbnkpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIFwiW3B1c2hNZXNzYWdlXSBmYWlsIHRvIGRpc3BhdGNoIG1zZyB0byBzZXJ2ZXJJZDogXCIgK1xuICAgICAgICAgICAgc2VydmVySWQgK1xuICAgICAgICAgICAgXCIsIGVycjpcIiArXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgKTtcbiAgICAgICAgbGF0Y2guZG9uZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZmFpbHMpIHtcbiAgICAgICAgZmFpbElkcyA9IGZhaWxJZHMuY29uY2F0KGZhaWxzKTtcbiAgICAgIH1cbiAgICAgIHN1Y2Nlc3NGbGFnID0gdHJ1ZTtcbiAgICAgIGxhdGNoLmRvbmUoKTtcbiAgICB9O1xuICB9O1xuXG4gIG9wdHMgPSB7IHR5cGU6IFwicHVzaFwiLCB1c2VyT3B0aW9uczogb3B0cyB8fCB7fSB9O1xuICAvLyBmb3IgY29tcGF0aWJsaXR5XG4gIG9wdHMuaXNQdXNoID0gdHJ1ZTtcblxuICBsZXQgc2VuZE1lc3NhZ2UgPSAoc2lkOiBzdHJpbmcpID0+IHtcbiAgICByZXR1cm4gKCgpID0+IHtcbiAgICAgIGlmIChzaWQgPT09IGFwcC5zZXJ2ZXJJZCkge1xuICAgICAgICAoPGFueT5jaGFubmVsU2VydmljZSkuY2hhbm5lbFJlbW90ZVttZXRob2RdKFxuICAgICAgICAgIHJvdXRlLFxuICAgICAgICAgIG1zZyxcbiAgICAgICAgICBncm91cHNbc2lkXSxcbiAgICAgICAgICBvcHRzLFxuICAgICAgICAgIHJwY0NCKHNpZClcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFwcC5ycGNJbnZva2UoXG4gICAgICAgICAgc2lkLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlLFxuICAgICAgICAgICAgc2VydmljZTogc2VydmljZSxcbiAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgICAgYXJnczogW3JvdXRlLCBtc2csIGdyb3Vwc1tzaWRdLCBvcHRzXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcnBjQ0Ioc2lkKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH07XG5cbiAgbGV0IGdyb3VwO1xuICBmb3IgKGxldCBzaWQgaW4gZ3JvdXBzKSB7XG4gICAgZ3JvdXAgPSBncm91cHNbc2lkXTtcbiAgICBpZiAoZ3JvdXAgJiYgZ3JvdXAubGVuZ3RoID4gMCkge1xuICAgICAgc2VuZE1lc3NhZ2Uoc2lkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZW1wdHkgZ3JvdXBcbiAgICAgIHByb2Nlc3MubmV4dFRpY2socnBjQ0Ioc2lkKSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlc3RvcmVDaGFubmVsKHNlbGY6IENoYW5uZWxTZXJ2aWNlLCBjYj86IEZ1bmN0aW9uKSB7XG4gIGlmICghc2VsZi5zdG9yZSkge1xuICAgIGludm9rZUNhbGxiYWNrKGNiISk7XG4gICAgcmV0dXJuO1xuICB9IGVsc2Uge1xuICAgIGxvYWRBbGxGcm9tU3RvcmUoc2VsZiwgZ2VuS2V5KHNlbGYpLCAoZXJyOiBhbnksIGxpc3Q6IGFueSkgPT4ge1xuICAgICAgaWYgKCEhZXJyKSB7XG4gICAgICAgIGludm9rZUNhbGxiYWNrKGNiISwgZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFsaXN0Lmxlbmd0aCB8fCAhQXJyYXkuaXNBcnJheShsaXN0KSkge1xuICAgICAgICAgIGludm9rZUNhbGxiYWNrKGNiISk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsb2FkID0gKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgcmV0dXJuICgoKSA9PiB7XG4gICAgICAgICAgICBsb2FkQWxsRnJvbVN0b3JlKHNlbGYsIGtleSwgKGVycjogYW55LCBpdGVtczogc3RyaW5nW10pID0+IHtcbiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpdGVtcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGxldCBhcnJheSA9IGl0ZW1zW2pdLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgICAgICBsZXQgc2lkID0gYXJyYXlbMF07XG4gICAgICAgICAgICAgICAgbGV0IHVpZCA9IGFycmF5WzFdO1xuICAgICAgICAgICAgICAgIGxldCBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tuYW1lXTtcbiAgICAgICAgICAgICAgICBsZXQgcmVzID0gYWRkKHVpZCwgc2lkLCBjaGFubmVsLmdyb3Vwcyk7XG4gICAgICAgICAgICAgICAgaWYgKHJlcykge1xuICAgICAgICAgICAgICAgICAgKDxhbnk+Y2hhbm5lbCkucmVjb3Jkc1t1aWRdID0geyBzaWQ6IHNpZCwgdWlkOiB1aWQgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgbGV0IG5hbWUgPSBsaXN0W2ldLnNsaWNlKGdlbktleShzZWxmKS5sZW5ndGggKyAxKTtcbiAgICAgICAgICBzZWxmLmNoYW5uZWxzW25hbWVdID0gbmV3IENoYW5uZWwobmFtZSwgc2VsZik7XG4gICAgICAgICAgbG9hZChsaXN0W2ldKTtcbiAgICAgICAgfVxuICAgICAgICBpbnZva2VDYWxsYmFjayhjYiEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFkZFRvU3RvcmUoc2VsZjogQ2hhbm5lbFNlcnZpY2UsIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gIGlmICghIXNlbGYuc3RvcmUpIHtcbiAgICBzZWxmLnN0b3JlLmFkZChrZXksIHZhbHVlLCAoZXJyOiBhbnkpID0+IHtcbiAgICAgIGlmICghIWVycikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgXCJhZGQga2V5OiAlcyB2YWx1ZTogJXMgdG8gc3RvcmUsIHdpdGggZXJyOiAlalwiLFxuICAgICAgICAgIGtleSxcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVGcm9tU3RvcmUoc2VsZjogQ2hhbm5lbFNlcnZpY2UsIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gIGlmICghIXNlbGYuc3RvcmUpIHtcbiAgICBzZWxmLnN0b3JlLnJlbW92ZShrZXksIHZhbHVlLCAoZXJyOiBhbnkpID0+IHtcbiAgICAgIGlmICghIWVycikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgXCJyZW1vdmUga2V5OiAlcyB2YWx1ZTogJXMgZnJvbSBzdG9yZSwgd2l0aCBlcnI6ICVqXCIsXG4gICAgICAgICAga2V5LFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGxvYWRBbGxGcm9tU3RvcmUoc2VsZjogQ2hhbm5lbFNlcnZpY2UsIGtleTogc3RyaW5nLCBjYj86IEZ1bmN0aW9uKSB7XG4gIGlmICghIXNlbGYuc3RvcmUpIHtcbiAgICBzZWxmLnN0b3JlLmxvYWQoa2V5LCAoZXJyOiBhbnksIGxpc3Q6IGFueSkgPT4ge1xuICAgICAgaWYgKCEhZXJyKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcImxvYWQga2V5OiAlcyBmcm9tIHN0b3JlLCB3aXRoIGVycjogJWpcIiwga2V5LCBlcnIuc3RhY2spO1xuICAgICAgICBpbnZva2VDYWxsYmFjayhjYiEsIGVycik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbnZva2VDYWxsYmFjayhjYiEsIG51bGwsIGxpc3QpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUFsbEZyb21TdG9yZShzZWxmOiBDaGFubmVsU2VydmljZSwga2V5OiBzdHJpbmcpIHtcbiAgaWYgKCEhc2VsZi5zdG9yZSkge1xuICAgIHNlbGYuc3RvcmUucmVtb3ZlQWxsKGtleSwgKGVycjogYW55KSA9PiB7XG4gICAgICBpZiAoISFlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIFwicmVtb3ZlIGtleTogJXMgYWxsIG1lbWJlcnMgZnJvbSBzdG9yZSwgd2l0aCBlcnI6ICVqXCIsXG4gICAgICAgICAga2V5LFxuICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdlbktleShzZWxmOiBDaGFubmVsU2VydmljZSwgbmFtZT86IHN0cmluZykge1xuICBpZiAoISFuYW1lKSB7XG4gICAgcmV0dXJuIHNlbGYucHJlZml4ICsgXCI6XCIgKyBzZWxmLmFwcC5zZXJ2ZXJJZCArIFwiOlwiICsgbmFtZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2VsZi5wcmVmaXggKyBcIjpcIiArIHNlbGYuYXBwLnNlcnZlcklkO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdlblZhbHVlKHNpZDogc3RyaW5nLCB1aWQ6IHN0cmluZykge1xuICByZXR1cm4gc2lkICsgXCI6XCIgKyB1aWQ7XG59XG4iXX0=