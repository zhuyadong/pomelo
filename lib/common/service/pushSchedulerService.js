"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../../index");
const logger = require("pomelo-logger").getLogger("pomelo", __filename);
class PushSchedulerComponent {
    constructor(app, opts) {
        this.app = app;
        this.name = "__pushScheduler__";
        opts = opts || {};
        this.scheduler = this.getScheduler(app, opts);
    }
    afterStart(cb) {
        if (this.isSelectable) {
            for (let k in this.scheduler) {
                let sch = this.scheduler[k];
                if (typeof sch.start === "function") {
                    sch.start();
                }
            }
            process.nextTick(cb);
        }
        else if (typeof this.scheduler.start === "function") {
            this.scheduler.start(cb);
        }
        else {
            process.nextTick(cb);
        }
    }
    stop(force, cb) {
        if (this.isSelectable) {
            for (let k in this.scheduler) {
                let sch = this.scheduler[k];
                if (typeof sch.stop === "function") {
                    sch.stop();
                }
            }
            process.nextTick(cb);
        }
        else if (typeof this.scheduler.stop === "function") {
            this.scheduler.stop(cb);
        }
        else {
            process.nextTick(cb);
        }
    }
    schedule(reqId, route, msg, recvs, opts, cb) {
        if (this.isSelectable) {
            if (typeof this.selector === "function") {
                this.selector(reqId, route, msg, recvs, opts, (id) => {
                    if (this.scheduler[id] &&
                        typeof this.scheduler[id].schedule === "function") {
                        this.scheduler[id].schedule(reqId, route, msg, recvs, opts, cb);
                    }
                    else {
                        logger.error("invalid pushScheduler id, id: %j", id);
                    }
                });
            }
            else {
                logger.error("the selector for pushScheduler is not a function, selector: %j", this.selector);
            }
        }
        else {
            if (typeof this.scheduler.schedule === "function") {
                this.scheduler.schedule(reqId, route, msg, recvs, opts, cb);
            }
            else {
                logger.error("the scheduler does not have a schedule function, scheduler: %j", this.scheduler);
            }
        }
    }
    getScheduler(app, opts) {
        let scheduler = opts.scheduler || index_1.DirectPushSchedulerConstructor;
        if (typeof scheduler === "function") {
            return scheduler(app, opts);
        }
        if (Array.isArray(scheduler)) {
            let res = {};
            scheduler.forEach((sch) => {
                if (typeof sch.scheduler === "function") {
                    res[sch.id] = sch.scheduler(app, sch.options);
                }
                else {
                    res[sch.id] = sch.scheduler;
                }
            });
            this.isSelectable = true;
            this.selector = opts.selector;
            return res;
        }
        return scheduler;
    }
}
exports.PushSchedulerComponent = PushSchedulerComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaFNjaGVkdWxlclNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwdXNoU2NoZWR1bGVyU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQU1xQjtBQUNyQixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUV4RTtJQVlFLFlBQXFCLEdBQWdCLEVBQUUsSUFBVTtRQUE1QixRQUFHLEdBQUgsR0FBRyxDQUFhO1FBWDVCLFNBQUksR0FBRyxtQkFBbUIsQ0FBQztRQVlsQyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFDRCxVQUFVLENBQUMsRUFBWTtRQUNyQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN0QixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxHQUFHLEdBQWtCLElBQUksQ0FBQyxTQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLEtBQUssS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNwQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2QsQ0FBQztZQUNILENBQUM7WUFDRCxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBbUIsSUFBSSxDQUFDLFNBQVUsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsU0FBVSxDQUFD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QUNILENBQUM7SUFDTyxZQUFZLENBQUMsR0FBZ0IsRUFBRSxJQUFTO1FBQzlDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksc0NBQThCLENBQUM7UUFDakUsRUFBRSxDQUFDLENBQUMsT0FBTyxTQUFTLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QixDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxHQUFHLEdBQWlCLEVBQUUsQ0FBQztZQUMzQixTQUFTLENBQUMsT0FBTyxDQUNmLENBQUMsR0FJQSxFQUFFLEVBQUU7Z0JBQ0gsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsU0FBUyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7b0JBQ3hDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNoRCxDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztnQkFDOUIsQ0FBQztZQUNILENBQUMsQ0FDRixDQUFDO1lBQ0YsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDekIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDYixDQUFDO1FBRUQsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0NBQ0Y7QUEvSEQsd0RBK0hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgU2NoZWR1bGVyLFxuICBTY2hlZHVsZXJNYXAsXG4gIEFwcGxpY2F0aW9uLFxuICBEaXJlY3RQdXNoU2NoZWR1bGVyQ29uc3RydWN0b3IsXG4gIFNjaGVkdWxlckNvbnN0cnVjdG9yXG59IGZyb20gXCIuLi8uLi9pbmRleFwiO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZShcInBvbWVsby1sb2dnZXJcIikuZ2V0TG9nZ2VyKFwicG9tZWxvXCIsIF9fZmlsZW5hbWUpO1xuXG5leHBvcnQgY2xhc3MgUHVzaFNjaGVkdWxlckNvbXBvbmVudCB7XG4gIHJlYWRvbmx5IG5hbWUgPSBcIl9fcHVzaFNjaGVkdWxlcl9fXCI7XG4gIHByaXZhdGUgaXNTZWxlY3RhYmxlOiBib29sZWFuO1xuICBwcml2YXRlIHNjaGVkdWxlcjogU2NoZWR1bGVyIHwgU2NoZWR1bGVyTWFwO1xuICBwcml2YXRlIHNlbGVjdG9yOiAoXG4gICAgcmVxSWQ6IG51bWJlcixcbiAgICByb3V0ZTogc3RyaW5nLFxuICAgIG1zZzogYW55LFxuICAgIHJlY3ZzOiBudW1iZXJbXSxcbiAgICBvcHRzOiBhbnksXG4gICAgY2I6IEZ1bmN0aW9uXG4gICkgPT4gdm9pZDtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IGFueSkge1xuICAgIG9wdHMgPSBvcHRzIHx8IHt9O1xuICAgIHRoaXMuc2NoZWR1bGVyID0gdGhpcy5nZXRTY2hlZHVsZXIoYXBwLCBvcHRzKTtcbiAgfVxuICBhZnRlclN0YXJ0KGNiOiBGdW5jdGlvbikge1xuICAgIGlmICh0aGlzLmlzU2VsZWN0YWJsZSkge1xuICAgICAgZm9yIChsZXQgayBpbiB0aGlzLnNjaGVkdWxlcikge1xuICAgICAgICBsZXQgc2NoID0gKDxTY2hlZHVsZXJNYXA+dGhpcy5zY2hlZHVsZXIpW2tdO1xuICAgICAgICBpZiAodHlwZW9mIHNjaC5zdGFydCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgc2NoLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHByb2Nlc3MubmV4dFRpY2soY2IpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mICg8U2NoZWR1bGVyPnRoaXMuc2NoZWR1bGVyKS5zdGFydCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAoPFNjaGVkdWxlcj50aGlzLnNjaGVkdWxlcikuc3RhcnQhKGNiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvY2Vzcy5uZXh0VGljayhjYik7XG4gICAgfVxuICB9XG5cbiAgc3RvcChmb3JjZTogYm9vbGVhbiwgY2I6IEZ1bmN0aW9uKSB7XG4gICAgaWYgKHRoaXMuaXNTZWxlY3RhYmxlKSB7XG4gICAgICBmb3IgKGxldCBrIGluIHRoaXMuc2NoZWR1bGVyKSB7XG4gICAgICAgIGxldCBzY2ggPSAoPFNjaGVkdWxlck1hcD50aGlzLnNjaGVkdWxlcilba107XG4gICAgICAgIGlmICh0eXBlb2Ygc2NoLnN0b3AgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIHNjaC5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHByb2Nlc3MubmV4dFRpY2soY2IpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mICg8U2NoZWR1bGVyPnRoaXMuc2NoZWR1bGVyKS5zdG9wID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICg8U2NoZWR1bGVyPnRoaXMuc2NoZWR1bGVyKS5zdG9wIShjYik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb2Nlc3MubmV4dFRpY2soY2IpO1xuICAgIH1cbiAgfVxuXG4gIHNjaGVkdWxlKFxuICAgIHJlcUlkOiBudW1iZXIsXG4gICAgcm91dGU6IHN0cmluZyxcbiAgICBtc2c6IGFueSxcbiAgICByZWN2czogbnVtYmVyW10sXG4gICAgb3B0czogYW55LFxuICAgIGNiOiBGdW5jdGlvblxuICApIHtcbiAgICBpZiAodGhpcy5pc1NlbGVjdGFibGUpIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3RvciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0b3IocmVxSWQsIHJvdXRlLCBtc2csIHJlY3ZzLCBvcHRzLCAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICg8U2NoZWR1bGVyTWFwPnRoaXMuc2NoZWR1bGVyKVtpZF0gJiZcbiAgICAgICAgICAgIHR5cGVvZiAoPFNjaGVkdWxlck1hcD50aGlzLnNjaGVkdWxlcilbaWRdLnNjaGVkdWxlID09PSBcImZ1bmN0aW9uXCJcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgICg8U2NoZWR1bGVyTWFwPnRoaXMuc2NoZWR1bGVyKVtpZF0uc2NoZWR1bGUoXG4gICAgICAgICAgICAgIHJlcUlkLFxuICAgICAgICAgICAgICByb3V0ZSxcbiAgICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgICByZWN2cyxcbiAgICAgICAgICAgICAgb3B0cyxcbiAgICAgICAgICAgICAgY2JcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcImludmFsaWQgcHVzaFNjaGVkdWxlciBpZCwgaWQ6ICVqXCIsIGlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIFwidGhlIHNlbGVjdG9yIGZvciBwdXNoU2NoZWR1bGVyIGlzIG5vdCBhIGZ1bmN0aW9uLCBzZWxlY3RvcjogJWpcIixcbiAgICAgICAgICB0aGlzLnNlbGVjdG9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0eXBlb2YgKDxTY2hlZHVsZXI+dGhpcy5zY2hlZHVsZXIpLnNjaGVkdWxlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgKDxTY2hlZHVsZXI+dGhpcy5zY2hlZHVsZXIpLnNjaGVkdWxlKFxuICAgICAgICAgIHJlcUlkLFxuICAgICAgICAgIHJvdXRlLFxuICAgICAgICAgIG1zZyxcbiAgICAgICAgICByZWN2cyxcbiAgICAgICAgICBvcHRzLFxuICAgICAgICAgIGNiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgXCJ0aGUgc2NoZWR1bGVyIGRvZXMgbm90IGhhdmUgYSBzY2hlZHVsZSBmdW5jdGlvbiwgc2NoZWR1bGVyOiAlalwiLFxuICAgICAgICAgIHRoaXMuc2NoZWR1bGVyXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHByaXZhdGUgZ2V0U2NoZWR1bGVyKGFwcDogQXBwbGljYXRpb24sIG9wdHM6IGFueSk6IFNjaGVkdWxlciB8IFNjaGVkdWxlck1hcCB7XG4gICAgbGV0IHNjaGVkdWxlciA9IG9wdHMuc2NoZWR1bGVyIHx8IERpcmVjdFB1c2hTY2hlZHVsZXJDb25zdHJ1Y3RvcjtcbiAgICBpZiAodHlwZW9mIHNjaGVkdWxlciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICByZXR1cm4gc2NoZWR1bGVyKGFwcCwgb3B0cyk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc2NoZWR1bGVyKSkge1xuICAgICAgbGV0IHJlczogU2NoZWR1bGVyTWFwID0ge307XG4gICAgICBzY2hlZHVsZXIuZm9yRWFjaChcbiAgICAgICAgKHNjaDoge1xuICAgICAgICAgIGlkOiBzdHJpbmc7XG4gICAgICAgICAgc2NoZWR1bGVyOiBTY2hlZHVsZXIgfCBTY2hlZHVsZXJDb25zdHJ1Y3RvcjtcbiAgICAgICAgICBvcHRpb25zPzogYW55O1xuICAgICAgICB9KSA9PiB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBzY2guc2NoZWR1bGVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHJlc1tzY2guaWRdID0gc2NoLnNjaGVkdWxlcihhcHAsIHNjaC5vcHRpb25zKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzW3NjaC5pZF0gPSBzY2guc2NoZWR1bGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuaXNTZWxlY3RhYmxlID0gdHJ1ZTtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBvcHRzLnNlbGVjdG9yO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG5cbiAgICByZXR1cm4gc2NoZWR1bGVyO1xuICB9XG59XG4iXX0=