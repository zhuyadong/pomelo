"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../../index");
const logger = require("pomelo-logger").getLogger("pomelo", __filename);
class PushSchedulerComponent {
    constructor(app, opts) {
        this.app = app;
        this.name = "__pushScheduler__";
        opts = opts || {};
        this.scheduler = this.getScheduler(app, opts);
    }
    afterStart(cb) {
        if (this.isSelectable) {
            for (let k in this.scheduler) {
                let sch = this.scheduler[k];
                if (typeof sch.start === "function") {
                    sch.start();
                }
            }
            process.nextTick(cb);
        }
        else if (typeof this.scheduler.start === "function") {
            this.scheduler.start(cb);
        }
        else {
            process.nextTick(cb);
        }
    }
    stop(force, cb) {
        if (this.isSelectable) {
            for (let k in this.scheduler) {
                let sch = this.scheduler[k];
                if (typeof sch.stop === "function") {
                    sch.stop();
                }
            }
            process.nextTick(cb);
        }
        else if (typeof this.scheduler.stop === "function") {
            this.scheduler.stop(cb);
        }
        else {
            process.nextTick(cb);
        }
    }
    schedule(reqId, route, msg, recvs, opts, cb) {
        if (this.isSelectable) {
            if (typeof this.selector === "function") {
                this.selector(reqId, route, msg, recvs, opts, (id) => {
                    if (this.scheduler[id] &&
                        typeof this.scheduler[id].schedule === "function") {
                        this.scheduler[id].schedule(reqId, route, msg, recvs, opts, cb);
                    }
                    else {
                        logger.error("invalid pushScheduler id, id: %j", id);
                    }
                });
            }
            else {
                logger.error("the selector for pushScheduler is not a function, selector: %j", this.selector);
            }
        }
        else {
            if (typeof this.scheduler.schedule === "function") {
                this.scheduler.schedule(reqId, route, msg, recvs, opts, cb);
            }
            else {
                logger.error("the scheduler does not have a schedule function, scheduler: %j", this.scheduler);
            }
        }
    }
    getScheduler(app, opts) {
        let scheduler = opts.scheduler || index_1.DirectPushSchedulerConstructor;
        if (typeof scheduler === "function") {
            return scheduler(app, opts);
        }
        if (Array.isArray(scheduler)) {
            let res = {};
            scheduler.forEach((sch) => {
                if (typeof sch.scheduler === "function") {
                    res[sch.id] = sch.scheduler(app, sch.options);
                }
                else {
                    res[sch.id] = sch.scheduler;
                }
            });
            this.isSelectable = true;
            this.selector = opts.selector;
            return res;
        }
        return scheduler;
    }
}
exports.PushSchedulerComponent = PushSchedulerComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVzaFNjaGVkdWxlclNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwdXNoU2NoZWR1bGVyU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQU1xQjtBQUNyQixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUV4RTtJQVlFLFlBQXFCLEdBQWdCLEVBQUUsSUFBVTtRQUE1QixRQUFHLEdBQUgsR0FBRyxDQUFhO1FBWDVCLFNBQUksR0FBRyxtQkFBbUIsQ0FBQztRQVlsQyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFDRCxVQUFVLENBQUMsRUFBWTtRQUNyQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN0QixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxHQUFHLEdBQWtCLElBQUksQ0FBQyxTQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLEtBQUssS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNwQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2QsQ0FBQztZQUNILENBQUM7WUFDRCxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBbUIsSUFBSSxDQUFDLFNBQVUsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsU0FBVSxDQUFD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QUNILENBQUM7SUFDTyxZQUFZLENBQUMsR0FBZ0IsRUFBRSxJQUFTO1FBQzlDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksc0NBQThCLENBQUM7UUFDakUsRUFBRSxDQUFDLENBQUMsT0FBTyxTQUFTLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QixDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxHQUFHLEdBQWlCLEVBQUUsQ0FBQztZQUMzQixTQUFTLENBQUMsT0FBTyxDQUNmLENBQUMsR0FJQSxFQUFFLEVBQUU7Z0JBQ0gsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsU0FBUyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7b0JBQ3hDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNoRCxDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztnQkFDOUIsQ0FBQztZQUNILENBQUMsQ0FDRixDQUFDO1lBQ0YsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDekIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDYixDQUFDO1FBRUQsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0NBQ0Y7QUEvSEQsd0RBK0hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBTY2hlZHVsZXIsXHJcbiAgU2NoZWR1bGVyTWFwLFxyXG4gIEFwcGxpY2F0aW9uLFxyXG4gIERpcmVjdFB1c2hTY2hlZHVsZXJDb25zdHJ1Y3RvcixcclxuICBTY2hlZHVsZXJDb25zdHJ1Y3RvclxyXG59IGZyb20gXCIuLi8uLi9pbmRleFwiO1xyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKFwicG9tZWxvLWxvZ2dlclwiKS5nZXRMb2dnZXIoXCJwb21lbG9cIiwgX19maWxlbmFtZSk7XHJcblxyXG5leHBvcnQgY2xhc3MgUHVzaFNjaGVkdWxlckNvbXBvbmVudCB7XHJcbiAgcmVhZG9ubHkgbmFtZSA9IFwiX19wdXNoU2NoZWR1bGVyX19cIjtcclxuICBwcml2YXRlIGlzU2VsZWN0YWJsZTogYm9vbGVhbjtcclxuICBwcml2YXRlIHNjaGVkdWxlcjogU2NoZWR1bGVyIHwgU2NoZWR1bGVyTWFwO1xyXG4gIHByaXZhdGUgc2VsZWN0b3I6IChcclxuICAgIHJlcUlkOiBudW1iZXIsXHJcbiAgICByb3V0ZTogc3RyaW5nLFxyXG4gICAgbXNnOiBhbnksXHJcbiAgICByZWN2czogbnVtYmVyW10sXHJcbiAgICBvcHRzOiBhbnksXHJcbiAgICBjYjogRnVuY3Rpb25cclxuICApID0+IHZvaWQ7XHJcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IGFueSkge1xyXG4gICAgb3B0cyA9IG9wdHMgfHwge307XHJcbiAgICB0aGlzLnNjaGVkdWxlciA9IHRoaXMuZ2V0U2NoZWR1bGVyKGFwcCwgb3B0cyk7XHJcbiAgfVxyXG4gIGFmdGVyU3RhcnQoY2I6IEZ1bmN0aW9uKSB7XHJcbiAgICBpZiAodGhpcy5pc1NlbGVjdGFibGUpIHtcclxuICAgICAgZm9yIChsZXQgayBpbiB0aGlzLnNjaGVkdWxlcikge1xyXG4gICAgICAgIGxldCBzY2ggPSAoPFNjaGVkdWxlck1hcD50aGlzLnNjaGVkdWxlcilba107XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzY2guc3RhcnQgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgc2NoLnN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHByb2Nlc3MubmV4dFRpY2soY2IpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgKDxTY2hlZHVsZXI+dGhpcy5zY2hlZHVsZXIpLnN0YXJ0ID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgKDxTY2hlZHVsZXI+dGhpcy5zY2hlZHVsZXIpLnN0YXJ0IShjYik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGNiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHN0b3AoZm9yY2U6IGJvb2xlYW4sIGNiOiBGdW5jdGlvbikge1xyXG4gICAgaWYgKHRoaXMuaXNTZWxlY3RhYmxlKSB7XHJcbiAgICAgIGZvciAobGV0IGsgaW4gdGhpcy5zY2hlZHVsZXIpIHtcclxuICAgICAgICBsZXQgc2NoID0gKDxTY2hlZHVsZXJNYXA+dGhpcy5zY2hlZHVsZXIpW2tdO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2NoLnN0b3AgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgc2NoLnN0b3AoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcHJvY2Vzcy5uZXh0VGljayhjYik7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiAoPFNjaGVkdWxlcj50aGlzLnNjaGVkdWxlcikuc3RvcCA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICg8U2NoZWR1bGVyPnRoaXMuc2NoZWR1bGVyKS5zdG9wIShjYik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGNiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNjaGVkdWxlKFxyXG4gICAgcmVxSWQ6IG51bWJlcixcclxuICAgIHJvdXRlOiBzdHJpbmcsXHJcbiAgICBtc2c6IGFueSxcclxuICAgIHJlY3ZzOiBudW1iZXJbXSxcclxuICAgIG9wdHM6IGFueSxcclxuICAgIGNiOiBGdW5jdGlvblxyXG4gICkge1xyXG4gICAgaWYgKHRoaXMuaXNTZWxlY3RhYmxlKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3RvciA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RvcihyZXFJZCwgcm91dGUsIG1zZywgcmVjdnMsIG9wdHMsIChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICg8U2NoZWR1bGVyTWFwPnRoaXMuc2NoZWR1bGVyKVtpZF0gJiZcclxuICAgICAgICAgICAgdHlwZW9mICg8U2NoZWR1bGVyTWFwPnRoaXMuc2NoZWR1bGVyKVtpZF0uc2NoZWR1bGUgPT09IFwiZnVuY3Rpb25cIlxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICg8U2NoZWR1bGVyTWFwPnRoaXMuc2NoZWR1bGVyKVtpZF0uc2NoZWR1bGUoXHJcbiAgICAgICAgICAgICAgcmVxSWQsXHJcbiAgICAgICAgICAgICAgcm91dGUsXHJcbiAgICAgICAgICAgICAgbXNnLFxyXG4gICAgICAgICAgICAgIHJlY3ZzLFxyXG4gICAgICAgICAgICAgIG9wdHMsXHJcbiAgICAgICAgICAgICAgY2JcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcImludmFsaWQgcHVzaFNjaGVkdWxlciBpZCwgaWQ6ICVqXCIsIGlkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsb2dnZXIuZXJyb3IoXHJcbiAgICAgICAgICBcInRoZSBzZWxlY3RvciBmb3IgcHVzaFNjaGVkdWxlciBpcyBub3QgYSBmdW5jdGlvbiwgc2VsZWN0b3I6ICVqXCIsXHJcbiAgICAgICAgICB0aGlzLnNlbGVjdG9yXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHR5cGVvZiAoPFNjaGVkdWxlcj50aGlzLnNjaGVkdWxlcikuc2NoZWR1bGUgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICg8U2NoZWR1bGVyPnRoaXMuc2NoZWR1bGVyKS5zY2hlZHVsZShcclxuICAgICAgICAgIHJlcUlkLFxyXG4gICAgICAgICAgcm91dGUsXHJcbiAgICAgICAgICBtc2csXHJcbiAgICAgICAgICByZWN2cyxcclxuICAgICAgICAgIG9wdHMsXHJcbiAgICAgICAgICBjYlxyXG4gICAgICAgICk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxyXG4gICAgICAgICAgXCJ0aGUgc2NoZWR1bGVyIGRvZXMgbm90IGhhdmUgYSBzY2hlZHVsZSBmdW5jdGlvbiwgc2NoZWR1bGVyOiAlalwiLFxyXG4gICAgICAgICAgdGhpcy5zY2hlZHVsZXJcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0U2NoZWR1bGVyKGFwcDogQXBwbGljYXRpb24sIG9wdHM6IGFueSk6IFNjaGVkdWxlciB8IFNjaGVkdWxlck1hcCB7XHJcbiAgICBsZXQgc2NoZWR1bGVyID0gb3B0cy5zY2hlZHVsZXIgfHwgRGlyZWN0UHVzaFNjaGVkdWxlckNvbnN0cnVjdG9yO1xyXG4gICAgaWYgKHR5cGVvZiBzY2hlZHVsZXIgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICByZXR1cm4gc2NoZWR1bGVyKGFwcCwgb3B0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc2NoZWR1bGVyKSkge1xyXG4gICAgICBsZXQgcmVzOiBTY2hlZHVsZXJNYXAgPSB7fTtcclxuICAgICAgc2NoZWR1bGVyLmZvckVhY2goXHJcbiAgICAgICAgKHNjaDoge1xyXG4gICAgICAgICAgaWQ6IHN0cmluZztcclxuICAgICAgICAgIHNjaGVkdWxlcjogU2NoZWR1bGVyIHwgU2NoZWR1bGVyQ29uc3RydWN0b3I7XHJcbiAgICAgICAgICBvcHRpb25zPzogYW55O1xyXG4gICAgICAgIH0pID0+IHtcclxuICAgICAgICAgIGlmICh0eXBlb2Ygc2NoLnNjaGVkdWxlciA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHJlc1tzY2guaWRdID0gc2NoLnNjaGVkdWxlcihhcHAsIHNjaC5vcHRpb25zKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc1tzY2guaWRdID0gc2NoLnNjaGVkdWxlcjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuaXNTZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgdGhpcy5zZWxlY3RvciA9IG9wdHMuc2VsZWN0b3I7XHJcbiAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHNjaGVkdWxlcjtcclxuICB9XHJcbn1cclxuIl19