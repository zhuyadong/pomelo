"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const application_1 = require("./application");
const events_1 = require("./util/events");
exports.events = events_1.default;
const backendSessionCtor = require("./components/backendSession");
const channelCtor = require("./components/channel");
const connectionCtor = require("./components/connection");
const connectorCtor = require("./components/connector");
const dictionaryCtor = require("./components/dictionary");
const masterCtor = require("./components/master");
const monitorCtor = require("./components/monitor");
const protobufCtor = require("./components/protobuf");
const proxyCtor = require("./components/proxy");
const pushSchedulerCtor = require("./components/pushScheduler");
const serverCtor = require("./components/server");
const sessionCtor = require("./components/session");
const remoteCtor = require("./components/remote");
const timeoutCtor = require("./filters/handler/timeout");
const Package = require("../package");
class Pomelo {
    constructor() {
        this.version = Package.version;
        this._components = {};
        this._filters = {};
        this._rpcFilters = {};
        this._connectors = {};
        this._pushSchedulers = {};
        fs.readdirSync(__dirname + "/components").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./components/", name);
            this._components.__defineGetter__(name, _load);
            //(<any>this).__defineGetter__(name, _load);
        });
        fs.readdirSync(__dirname + "/filters/handler").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./filters/handler/", name);
            this._filters.__defineGetter__(name, _load);
            //module.exports.__defineGetter__(name, _load);
        });
        fs.readdirSync(__dirname + "/filters/rpc").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./filters/rpc/", name);
            this._rpcFilters.__defineGetter__(name, _load);
        });
        this._connectors.__defineGetter__("sioconnector", load.bind(null, "./connectors/sioconnector"));
        this._connectors.__defineGetter__("hybridconnector", load.bind(null, "./connectors/hybridconnector"));
        this._connectors.__defineGetter__("udpconnector", load.bind(null, "./connectors/udpconnector"));
        this._connectors.__defineGetter__("mqttconnector", load.bind(null, "./connectors/mqttconnector"));
        this._pushSchedulers.__defineGetter__("direct", load.bind(null, "./pushSchedulers/direct"));
        this._pushSchedulers.__defineGetter__("buffer", load.bind(null, "./pushSchedulers/buffer"));
    }
    get app() {
        return application_1.default.instance;
    }
    createApp(opts) {
        this.app.init(opts);
        return this.app;
    }
    get components() {
        return this._components;
    }
    get connectors() {
        return this._connectors;
    }
    get filters() {
        return this._filters;
    }
    get rpcFilters() {
        return this._rpcFilters;
    }
    get backendSession() {
        return backendSessionCtor;
    }
    get channel() {
        return channelCtor;
    }
    get connection() {
        return connectionCtor;
    }
    get connector() {
        return connectorCtor;
    }
    get dictionary() {
        return dictionaryCtor;
    }
    get master() {
        return masterCtor;
    }
    get monitor() {
        return monitorCtor;
    }
    get protobuf() {
        return protobufCtor;
    }
    get proxy() {
        return proxyCtor;
    }
    get pushScheduler() {
        return pushSchedulerCtor;
    }
    get remote() {
        return remoteCtor;
    }
    get server() {
        return serverCtor;
    }
    get session() {
        return sessionCtor;
    }
    get timeout() {
        return timeoutCtor;
    }
}
exports.Pomelo = Pomelo;
function load(path, name) {
    let mod;
    if (name) {
        mod = require(path + name);
    }
    else {
        mod = require(path);
    }
    if (mod && mod.default)
        mod = mod.default;
    return mod;
}
let pomelo = new Pomelo();
exports.default = pomelo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9tZWxvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicG9tZWxvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEseUJBQTBCO0FBQzFCLDZCQUE4QjtBQUM5QiwrQ0FBb0Q7QUFDcEQsMENBQW1DO0FBZ0IxQixpQkFoQkYsZ0JBQU0sQ0FnQkU7QUFkZixrRUFBbUU7QUFDbkUsb0RBQXFEO0FBQ3JELDBEQUEyRDtBQUMzRCx3REFBeUQ7QUFDekQsMERBQTJEO0FBQzNELGtEQUFtRDtBQUNuRCxvREFBcUQ7QUFDckQsc0RBQXVEO0FBQ3ZELGdEQUFpRDtBQUNqRCxnRUFBaUU7QUFDakUsa0RBQW1EO0FBQ25ELG9EQUFxRDtBQUNyRCxrREFBbUQ7QUFDbkQseURBQTBEO0FBbUIxRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFdEM7SUFPRTtRQU5TLFlBQU8sR0FBVyxPQUFPLENBQUMsT0FBTyxDQUFDO1FBT3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBc0IsQ0FBQztRQUMxQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQW1CLENBQUM7UUFDcEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFzQixDQUFDO1FBQzFDLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBc0IsQ0FBQztRQUMxQyxJQUFJLENBQUMsZUFBZSxHQUFHLEVBQTBCLENBQUM7UUFFbEQsRUFBRSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzNELEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLE1BQU0sQ0FBQztZQUNULENBQUM7WUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMxQyxJQUFJLEtBQUssR0FBRyxJQUFJLENB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TSxDQUFDLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0Y7QUF0SUQsd0JBc0lDO0FBNkNELGNBQWMsSUFBWSxFQUFFLElBQVk7SUFDdEMsSUFBSSxHQUFRLENBQUM7SUFDYixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1QsR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUM7UUFBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztJQUMxQyxNQUFNLENBQUMsR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUVELElBQUksTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFDMUIsa0JBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEh5YnJpZENvbm5lY3RvciBmcm9tIFwiLi9jb25uZWN0b3JzL2h5YnJpZGNvbm5lY3RvclwiO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSBcImV2ZW50c1wiO1xuaW1wb3J0IGZzID0gcmVxdWlyZShcImZzXCIpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmltcG9ydCBBcHBsaWNhdGlvbiwgeyBGaWx0ZXIgfSBmcm9tIFwiLi9hcHBsaWNhdGlvblwiO1xuaW1wb3J0IGV2ZW50cyBmcm9tIFwiLi91dGlsL2V2ZW50c1wiO1xuaW1wb3J0IHsgU29ja2V0IH0gZnJvbSBcIm5ldFwiO1xuaW1wb3J0IGJhY2tlbmRTZXNzaW9uQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvYmFja2VuZFNlc3Npb25cIik7XG5pbXBvcnQgY2hhbm5lbEN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL2NoYW5uZWxcIik7XG5pbXBvcnQgY29ubmVjdGlvbkN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL2Nvbm5lY3Rpb25cIik7XG5pbXBvcnQgY29ubmVjdG9yQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvY29ubmVjdG9yXCIpO1xuaW1wb3J0IGRpY3Rpb25hcnlDdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9kaWN0aW9uYXJ5XCIpO1xuaW1wb3J0IG1hc3RlckN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL21hc3RlclwiKTtcbmltcG9ydCBtb25pdG9yQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvbW9uaXRvclwiKTtcbmltcG9ydCBwcm90b2J1ZkN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL3Byb3RvYnVmXCIpO1xuaW1wb3J0IHByb3h5Q3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvcHJveHlcIik7XG5pbXBvcnQgcHVzaFNjaGVkdWxlckN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL3B1c2hTY2hlZHVsZXJcIik7XG5pbXBvcnQgc2VydmVyQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvc2VydmVyXCIpO1xuaW1wb3J0IHNlc3Npb25DdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9zZXNzaW9uXCIpO1xuaW1wb3J0IHJlbW90ZUN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL3JlbW90ZVwiKTtcbmltcG9ydCB0aW1lb3V0Q3RvciA9IHJlcXVpcmUoXCIuL2ZpbHRlcnMvaGFuZGxlci90aW1lb3V0XCIpO1xuZXhwb3J0IHsgZXZlbnRzIH07XG5pbXBvcnQgYXBwIGZyb20gXCIuL2FwcGxpY2F0aW9uXCI7XG5pbXBvcnQgU2lvQ29ubmVjdG9yIGZyb20gXCIuL2Nvbm5lY3RvcnMvc2lvY29ubmVjdG9yXCI7XG5pbXBvcnQge1xuICBCYWNrZW5kU2Vzc2lvblNlcnZpY2UsXG4gIENoYW5uZWxTZXJ2aWNlLFxuICBDb25uZWN0aW9uQ29tcG9uZW50LFxuICBDb25uZWN0b3JDb21wb25lbnQsXG4gIERpY3Rpb25hcnlDb21wb25lbnQsXG4gIE1hc3RlckNvbXBvbmVudCxcbiAgTW9uaXRvckNvbXBvbmVudCxcbiAgUHJvdG9idWZDb21wb25lbnQsXG4gIFByb3h5Q29tcG9uZW50LFxuICBQdXNoU2NoZWR1bGVyQ29tcG9uZW50LFxuICBSZW1vdGVDb21wb25lbnQsXG4gIFNlcnZlckNvbXBvbmVudCxcbiAgU2Vzc2lvbkNvbXBvbmVudFxufSBmcm9tIFwiLi9pbmRleFwiO1xuY29uc3QgUGFja2FnZSA9IHJlcXVpcmUoXCIuLi9wYWNrYWdlXCIpO1xuXG5leHBvcnQgY2xhc3MgUG9tZWxvIHtcbiAgcmVhZG9ubHkgdmVyc2lvbjogc3RyaW5nID0gUGFja2FnZS52ZXJzaW9uO1xuICBwcml2YXRlIF9jb21wb25lbnRzOiBQb21lbG9Db21wb25lbnRzO1xuICBwcml2YXRlIF9maWx0ZXJzOiBQb21lbG9GaWx0ZXJzO1xuICBwcml2YXRlIF9ycGNGaWx0ZXJzOiBQb21lbG9SUENGaWx0ZXJzO1xuICBwcml2YXRlIF9jb25uZWN0b3JzOiBQb21lbG9Db25uZWN0b3JzO1xuICBwcml2YXRlIF9wdXNoU2NoZWR1bGVyczogUG9tZWxvUHVzaFNjaGVkdWxlcnM7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2NvbXBvbmVudHMgPSB7fSBhcyBQb21lbG9Db21wb25lbnRzO1xuICAgIHRoaXMuX2ZpbHRlcnMgPSB7fSBhcyBQb21lbG9GaWx0ZXJzO1xuICAgIHRoaXMuX3JwY0ZpbHRlcnMgPSB7fSBhcyBQb21lbG9SUENGaWx0ZXJzO1xuICAgIHRoaXMuX2Nvbm5lY3RvcnMgPSB7fSBhcyBQb21lbG9Db25uZWN0b3JzO1xuICAgIHRoaXMuX3B1c2hTY2hlZHVsZXJzID0ge30gYXMgUG9tZWxvUHVzaFNjaGVkdWxlcnM7XG5cbiAgICBmcy5yZWFkZGlyU3luYyhfX2Rpcm5hbWUgKyBcIi9jb21wb25lbnRzXCIpLmZvckVhY2goZmlsZW5hbWUgPT4ge1xuICAgICAgaWYgKCEvXFwuanMkLy50ZXN0KGZpbGVuYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgbmFtZSA9IHBhdGguYmFzZW5hbWUoZmlsZW5hbWUsIFwiLmpzXCIpO1xuICAgICAgbGV0IF9sb2FkID0gbG9hZC5iaW5kKG51bGwsIFwiLi9jb21wb25lbnRzL1wiLCBuYW1lKTtcblxuICAgICAgKDxhbnk+dGhpcy5fY29tcG9uZW50cykuX19kZWZpbmVHZXR0ZXJfXyhuYW1lLCBfbG9hZCk7XG4gICAgICAvLyg8YW55PnRoaXMpLl9fZGVmaW5lR2V0dGVyX18obmFtZSwgX2xvYWQpO1xuICAgIH0pO1xuICAgIGZzLnJlYWRkaXJTeW5jKF9fZGlybmFtZSArIFwiL2ZpbHRlcnMvaGFuZGxlclwiKS5mb3JFYWNoKGZpbGVuYW1lID0+IHtcbiAgICAgIGlmICghL1xcLmpzJC8udGVzdChmaWxlbmFtZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IG5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGVuYW1lLCBcIi5qc1wiKTtcbiAgICAgIGxldCBfbG9hZCA9IGxvYWQuYmluZChudWxsLCBcIi4vZmlsdGVycy9oYW5kbGVyL1wiLCBuYW1lKTtcblxuICAgICAgKDxhbnk+dGhpcy5fZmlsdGVycykuX19kZWZpbmVHZXR0ZXJfXyhuYW1lLCBfbG9hZCk7XG4gICAgICAvL21vZHVsZS5leHBvcnRzLl9fZGVmaW5lR2V0dGVyX18obmFtZSwgX2xvYWQpO1xuICAgIH0pO1xuICAgIGZzLnJlYWRkaXJTeW5jKF9fZGlybmFtZSArIFwiL2ZpbHRlcnMvcnBjXCIpLmZvckVhY2goZmlsZW5hbWUgPT4ge1xuICAgICAgaWYgKCEvXFwuanMkLy50ZXN0KGZpbGVuYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgbmFtZSA9IHBhdGguYmFzZW5hbWUoZmlsZW5hbWUsIFwiLmpzXCIpO1xuICAgICAgbGV0IF9sb2FkID0gbG9hZC5iaW5kKG51bGwsIFwiLi9maWx0ZXJzL3JwYy9cIiwgbmFtZSk7XG5cbiAgICAgICg8YW55PnRoaXMuX3JwY0ZpbHRlcnMpLl9fZGVmaW5lR2V0dGVyX18obmFtZSwgX2xvYWQpO1xuICAgIH0pO1xuICAgICg8YW55PnRoaXMuX2Nvbm5lY3RvcnMpLl9fZGVmaW5lR2V0dGVyX18oXG4gICAgICBcInNpb2Nvbm5lY3RvclwiLFxuICAgICAgbG9hZC5iaW5kKG51bGwsIFwiLi9jb25uZWN0b3JzL3Npb2Nvbm5lY3RvclwiKVxuICAgICk7XG4gICAgKDxhbnk+dGhpcy5fY29ubmVjdG9ycykuX19kZWZpbmVHZXR0ZXJfXyhcbiAgICAgIFwiaHlicmlkY29ubmVjdG9yXCIsXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL2Nvbm5lY3RvcnMvaHlicmlkY29ubmVjdG9yXCIpXG4gICAgKTtcbiAgICAoPGFueT50aGlzLl9jb25uZWN0b3JzKS5fX2RlZmluZUdldHRlcl9fKFxuICAgICAgXCJ1ZHBjb25uZWN0b3JcIixcbiAgICAgIGxvYWQuYmluZChudWxsLCBcIi4vY29ubmVjdG9ycy91ZHBjb25uZWN0b3JcIilcbiAgICApO1xuICAgICg8YW55PnRoaXMuX2Nvbm5lY3RvcnMpLl9fZGVmaW5lR2V0dGVyX18oXG4gICAgICBcIm1xdHRjb25uZWN0b3JcIixcbiAgICAgIGxvYWQuYmluZChudWxsLCBcIi4vY29ubmVjdG9ycy9tcXR0Y29ubmVjdG9yXCIpXG4gICAgKTtcbiAgICAoPGFueT50aGlzLl9wdXNoU2NoZWR1bGVycykuX19kZWZpbmVHZXR0ZXJfXyhcbiAgICAgIFwiZGlyZWN0XCIsXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL3B1c2hTY2hlZHVsZXJzL2RpcmVjdFwiKVxuICAgICk7XG4gICAgKDxhbnk+dGhpcy5fcHVzaFNjaGVkdWxlcnMpLl9fZGVmaW5lR2V0dGVyX18oXG4gICAgICBcImJ1ZmZlclwiLFxuICAgICAgbG9hZC5iaW5kKG51bGwsIFwiLi9wdXNoU2NoZWR1bGVycy9idWZmZXJcIilcbiAgICApO1xuICB9XG5cbiAgZ2V0IGFwcCgpIHtcbiAgICByZXR1cm4gQXBwbGljYXRpb24uaW5zdGFuY2U7XG4gIH1cblxuICBjcmVhdGVBcHAob3B0cz86IGFueSkge1xuICAgIHRoaXMuYXBwLmluaXQob3B0cyk7XG4gICAgcmV0dXJuIHRoaXMuYXBwO1xuICB9XG5cbiAgZ2V0IGNvbXBvbmVudHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudHMgYXMgUmVhZG9ubHk8UG9tZWxvQ29tcG9uZW50cz47XG4gIH1cblxuICBnZXQgY29ubmVjdG9ycygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29ubmVjdG9ycyBhcyBSZWFkb25seTxQb21lbG9Db25uZWN0b3JzPjtcbiAgfVxuICBnZXQgZmlsdGVycygpIHtcbiAgICByZXR1cm4gdGhpcy5fZmlsdGVycyBhcyBSZWFkb25seTxQb21lbG9GaWx0ZXJzPjtcbiAgfVxuICBnZXQgcnBjRmlsdGVycygpIHtcbiAgICByZXR1cm4gdGhpcy5fcnBjRmlsdGVycyBhcyBSZWFkb25seTxQb21lbG9SUENGaWx0ZXJzPjtcbiAgfVxuXG4gIGdldCBiYWNrZW5kU2Vzc2lvbigpIHtcbiAgICByZXR1cm4gYmFja2VuZFNlc3Npb25DdG9yO1xuICB9XG4gIGdldCBjaGFubmVsKCkge1xuICAgIHJldHVybiBjaGFubmVsQ3RvcjtcbiAgfVxuICBnZXQgY29ubmVjdGlvbigpIHtcbiAgICByZXR1cm4gY29ubmVjdGlvbkN0b3I7XG4gIH1cbiAgZ2V0IGNvbm5lY3RvcigpIHtcbiAgICByZXR1cm4gY29ubmVjdG9yQ3RvcjtcbiAgfVxuICBnZXQgZGljdGlvbmFyeSgpIHtcbiAgICByZXR1cm4gZGljdGlvbmFyeUN0b3I7XG4gIH1cbiAgZ2V0IG1hc3RlcigpIHtcbiAgICByZXR1cm4gbWFzdGVyQ3RvcjtcbiAgfVxuICBnZXQgbW9uaXRvcigpIHtcbiAgICByZXR1cm4gbW9uaXRvckN0b3I7XG4gIH1cbiAgZ2V0IHByb3RvYnVmKCkge1xuICAgIHJldHVybiBwcm90b2J1ZkN0b3I7XG4gIH1cbiAgZ2V0IHByb3h5KCkge1xuICAgIHJldHVybiBwcm94eUN0b3I7XG4gIH1cbiAgZ2V0IHB1c2hTY2hlZHVsZXIoKSB7XG4gICAgcmV0dXJuIHB1c2hTY2hlZHVsZXJDdG9yO1xuICB9XG4gIGdldCByZW1vdGUoKSB7XG4gICAgcmV0dXJuIHJlbW90ZUN0b3I7XG4gIH1cbiAgZ2V0IHNlcnZlcigpIHtcbiAgICByZXR1cm4gc2VydmVyQ3RvcjtcbiAgfVxuICBnZXQgc2Vzc2lvbigpIHtcbiAgICByZXR1cm4gc2Vzc2lvbkN0b3I7XG4gIH1cbiAgZ2V0IHRpbWVvdXQoKSB7XG4gICAgcmV0dXJuIHRpbWVvdXRDdG9yO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVtb3RlQWRkcmVzcyB7XG4gIGlwOiBzdHJpbmc7XG4gIHBvcnQ6IHN0cmluZyB8IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJU29ja2V0IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgcmVhZG9ubHkgaWQ6IG51bWJlcjtcbiAgcmVhZG9ubHkgcmVtb3RlQWRkcmVzczogUmVhZG9ubHk8UmVtb3RlQWRkcmVzcz47XG4gIHNlbmQobXNnOiBhbnkpOiB2b2lkO1xuICBkaXNjb25uZWN0KCk6IHZvaWQ7XG4gIHNlbmRCYXRjaChtc2dzOiBBcnJheUxpa2U8YW55Pik6IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9tZWxvQ29tcG9uZW50cyB7XG4gIHJlYWRvbmx5IGJhY2tlbmRTZXNzaW9uOiAoYXBwOiBBcHBsaWNhdGlvbikgPT4gQmFja2VuZFNlc3Npb25TZXJ2aWNlO1xuICByZWFkb25seSBjaGFubmVsOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gQ2hhbm5lbFNlcnZpY2U7XG4gIHJlYWRvbmx5IGNvbm5lY3Rpb246IChhcHA6IEFwcGxpY2F0aW9uKSA9PiBDb25uZWN0aW9uQ29tcG9uZW50O1xuICByZWFkb25seSBjb25uZWN0b3I6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBDb25uZWN0b3JDb21wb25lbnQ7XG4gIHJlYWRvbmx5IGRpY3Rpb25hcnk6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBEaWN0aW9uYXJ5Q29tcG9uZW50O1xuICByZWFkb25seSBtYXN0ZXI6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBNYXN0ZXJDb21wb25lbnQ7XG4gIHJlYWRvbmx5IG1vbml0b3I6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBNb25pdG9yQ29tcG9uZW50O1xuICByZWFkb25seSBwcm90b2J1ZjogKGFwcDogQXBwbGljYXRpb24sIG9wdHM/OiBvYmplY3QpID0+IFByb3RvYnVmQ29tcG9uZW50O1xuICByZWFkb25seSBwcm94eTogKGFwcDogQXBwbGljYXRpb24sIG9wdHM/OiBvYmplY3QpID0+IFByb3h5Q29tcG9uZW50O1xuICByZWFkb25seSBwdXNoU2NoZWR1bGVyOiAoXG4gICAgYXBwOiBBcHBsaWNhdGlvbixcbiAgICBvcHRzPzogb2JqZWN0XG4gICkgPT4gUHVzaFNjaGVkdWxlckNvbXBvbmVudDtcbiAgcmVhZG9ubHkgcmVtb3RlOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gUmVtb3RlQ29tcG9uZW50O1xuICByZWFkb25seSBzZXJ2ZXI6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBTZXJ2ZXJDb21wb25lbnQ7XG4gIHJlYWRvbmx5IHNlc3Npb246IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBTZXNzaW9uQ29tcG9uZW50O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvbWVsb0ZpbHRlcnMge31cblxuZXhwb3J0IGludGVyZmFjZSBQb21lbG9SUENGaWx0ZXJzIHt9XG5cbmV4cG9ydCBpbnRlcmZhY2UgUG9tZWxvQ29ubmVjdG9ycyB7XG4gIGh5YnJpZGNvbm5lY3RvcjogSHlicmlkQ29ubmVjdG9yO1xuICBzaW9jb25uZWN0b3I6IFNpb0Nvbm5lY3Rvcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb21lbG9QdXNoU2NoZWR1bGVycyB7fVxuXG5mdW5jdGlvbiBsb2FkKHBhdGg6IHN0cmluZywgbmFtZTogc3RyaW5nKSB7XG4gIGxldCBtb2Q6IGFueTtcbiAgaWYgKG5hbWUpIHtcbiAgICBtb2QgPSByZXF1aXJlKHBhdGggKyBuYW1lKTtcbiAgfSBlbHNlIHtcbiAgICBtb2QgPSByZXF1aXJlKHBhdGgpO1xuICB9XG4gIGlmIChtb2QgJiYgbW9kLmRlZmF1bHQpIG1vZCA9IG1vZC5kZWZhdWx0O1xuICByZXR1cm4gbW9kO1xufVxuXG5sZXQgcG9tZWxvID0gbmV3IFBvbWVsbygpO1xuZXhwb3J0IGRlZmF1bHQgcG9tZWxvO1xuIl19