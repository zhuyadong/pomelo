"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const application_1 = require("./application");
const events_1 = require("./util/events");
exports.events = events_1.default;
const backendSessionCtor = require("./components/backendSession");
const channelCtor = require("./components/channel");
const connectionCtor = require("./components/connection");
const connectorCtor = require("./components/connector");
const dictionaryCtor = require("./components/dictionary");
const masterCtor = require("./components/master");
const monitorCtor = require("./components/monitor");
const protobufCtor = require("./components/protobuf");
const proxyCtor = require("./components/proxy");
const pushSchedulerCtor = require("./components/pushScheduler");
const serverCtor = require("./components/server");
const sessionCtor = require("./components/session");
const remoteCtor = require("./components/remote");
const timeoutCtor = require("./filters/handler/timeout");
const Package = require("../package");
class Pomelo {
    constructor() {
        this.version = Package.version;
        this._components = {};
        this._filters = {};
        this._rpcFilters = {};
        this._connectors = {};
        this._pushSchedulers = {};
        fs.readdirSync(__dirname + "/components").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./components/", name);
            this._components.__defineGetter__(name, _load);
            //(<any>this).__defineGetter__(name, _load);
        });
        fs.readdirSync(__dirname + "/filters/handler").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./filters/handler/", name);
            this._filters.__defineGetter__(name, _load);
            //module.exports.__defineGetter__(name, _load);
        });
        fs.readdirSync(__dirname + "/filters/rpc").forEach(filename => {
            if (!/\.js$/.test(filename)) {
                return;
            }
            let name = path.basename(filename, ".js");
            let _load = load.bind(null, "./filters/rpc/", name);
            this._rpcFilters.__defineGetter__(name, _load);
        });
        this._connectors.__defineGetter__("sioconnector", load.bind(null, "./connectors/sioconnector"));
        this._connectors.__defineGetter__("hybridconnector", load.bind(null, "./connectors/hybridconnector"));
        this._connectors.__defineGetter__("udpconnector", load.bind(null, "./connectors/udpconnector"));
        this._connectors.__defineGetter__("mqttconnector", load.bind(null, "./connectors/mqttconnector"));
        this._pushSchedulers.__defineGetter__("direct", load.bind(null, "./pushSchedulers/direct"));
        this._pushSchedulers.__defineGetter__("buffer", load.bind(null, "./pushSchedulers/buffer"));
    }
    get app() {
        return application_1.default.instance;
    }
    createApp(opts) {
        this.app.init(opts);
        return this.app;
    }
    get components() {
        return this._components;
    }
    get connectors() {
        return this._connectors;
    }
    get filters() {
        return this._filters;
    }
    get rpcFilters() {
        return this._rpcFilters;
    }
    get backendSession() {
        return backendSessionCtor;
    }
    get channel() {
        return channelCtor;
    }
    get connection() {
        return connectionCtor;
    }
    get connector() {
        return connectorCtor;
    }
    get dictionary() {
        return dictionaryCtor;
    }
    get master() {
        return masterCtor;
    }
    get monitor() {
        return monitorCtor;
    }
    get protobuf() {
        return protobufCtor;
    }
    get proxy() {
        return proxyCtor;
    }
    get pushScheduler() {
        return pushSchedulerCtor;
    }
    get remote() {
        return remoteCtor;
    }
    get server() {
        return serverCtor;
    }
    get session() {
        return sessionCtor;
    }
    get timeout() {
        return timeoutCtor;
    }
}
exports.Pomelo = Pomelo;
function load(path, name) {
    let mod;
    if (name) {
        mod = require(path + name);
    }
    else {
        mod = require(path);
    }
    if (mod && mod.default)
        mod = mod.default;
    return mod;
}
let pomelo = new Pomelo();
exports.default = pomelo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9tZWxvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicG9tZWxvLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEseUJBQTBCO0FBQzFCLDZCQUE4QjtBQUM5QiwrQ0FBb0Q7QUFDcEQsMENBQW1DO0FBZ0IxQixpQkFoQkYsZ0JBQU0sQ0FnQkU7QUFkZixrRUFBbUU7QUFDbkUsb0RBQXFEO0FBQ3JELDBEQUEyRDtBQUMzRCx3REFBeUQ7QUFDekQsMERBQTJEO0FBQzNELGtEQUFtRDtBQUNuRCxvREFBcUQ7QUFDckQsc0RBQXVEO0FBQ3ZELGdEQUFpRDtBQUNqRCxnRUFBaUU7QUFDakUsa0RBQW1EO0FBQ25ELG9EQUFxRDtBQUNyRCxrREFBbUQ7QUFDbkQseURBQTBEO0FBbUIxRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFdEM7SUFPRTtRQU5TLFlBQU8sR0FBVyxPQUFPLENBQUMsT0FBTyxDQUFDO1FBT3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBc0IsQ0FBQztRQUMxQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQW1CLENBQUM7UUFDcEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFzQixDQUFDO1FBQzFDLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBc0IsQ0FBQztRQUMxQyxJQUFJLENBQUMsZUFBZSxHQUFHLEVBQTBCLENBQUM7UUFFbEQsRUFBRSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzNELEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLE1BQU0sQ0FBQztZQUNULENBQUM7WUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMxQyxJQUFJLEtBQUssR0FBRyxJQUFJLENB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TSxDQUFDLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0Y7QUF0SUQsd0JBc0lDO0FBNkNELGNBQWMsSUFBWSxFQUFFLElBQVk7SUFDdEMsSUFBSSxHQUFRLENBQUM7SUFDYixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1QsR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUM7UUFBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztJQUMxQyxNQUFNLENBQUMsR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUVELElBQUksTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFDMUIsa0JBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEh5YnJpZENvbm5lY3RvciBmcm9tIFwiLi9jb25uZWN0b3JzL2h5YnJpZGNvbm5lY3RvclwiO1xyXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tIFwiZXZlbnRzXCI7XHJcbmltcG9ydCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcclxuaW1wb3J0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuaW1wb3J0IEFwcGxpY2F0aW9uLCB7IEZpbHRlciB9IGZyb20gXCIuL2FwcGxpY2F0aW9uXCI7XHJcbmltcG9ydCBldmVudHMgZnJvbSBcIi4vdXRpbC9ldmVudHNcIjtcclxuaW1wb3J0IHsgU29ja2V0IH0gZnJvbSBcIm5ldFwiO1xyXG5pbXBvcnQgYmFja2VuZFNlc3Npb25DdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9iYWNrZW5kU2Vzc2lvblwiKTtcclxuaW1wb3J0IGNoYW5uZWxDdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9jaGFubmVsXCIpO1xyXG5pbXBvcnQgY29ubmVjdGlvbkN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL2Nvbm5lY3Rpb25cIik7XHJcbmltcG9ydCBjb25uZWN0b3JDdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9jb25uZWN0b3JcIik7XHJcbmltcG9ydCBkaWN0aW9uYXJ5Q3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvZGljdGlvbmFyeVwiKTtcclxuaW1wb3J0IG1hc3RlckN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL21hc3RlclwiKTtcclxuaW1wb3J0IG1vbml0b3JDdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9tb25pdG9yXCIpO1xyXG5pbXBvcnQgcHJvdG9idWZDdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9wcm90b2J1ZlwiKTtcclxuaW1wb3J0IHByb3h5Q3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvcHJveHlcIik7XHJcbmltcG9ydCBwdXNoU2NoZWR1bGVyQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvcHVzaFNjaGVkdWxlclwiKTtcclxuaW1wb3J0IHNlcnZlckN0b3IgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL3NlcnZlclwiKTtcclxuaW1wb3J0IHNlc3Npb25DdG9yID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9zZXNzaW9uXCIpO1xyXG5pbXBvcnQgcmVtb3RlQ3RvciA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvcmVtb3RlXCIpO1xyXG5pbXBvcnQgdGltZW91dEN0b3IgPSByZXF1aXJlKFwiLi9maWx0ZXJzL2hhbmRsZXIvdGltZW91dFwiKTtcclxuZXhwb3J0IHsgZXZlbnRzIH07XHJcbmltcG9ydCBhcHAgZnJvbSBcIi4vYXBwbGljYXRpb25cIjtcclxuaW1wb3J0IFNpb0Nvbm5lY3RvciBmcm9tIFwiLi9jb25uZWN0b3JzL3Npb2Nvbm5lY3RvclwiO1xyXG5pbXBvcnQge1xyXG4gIEJhY2tlbmRTZXNzaW9uU2VydmljZSxcclxuICBDaGFubmVsU2VydmljZSxcclxuICBDb25uZWN0aW9uQ29tcG9uZW50LFxyXG4gIENvbm5lY3RvckNvbXBvbmVudCxcclxuICBEaWN0aW9uYXJ5Q29tcG9uZW50LFxyXG4gIE1hc3RlckNvbXBvbmVudCxcclxuICBNb25pdG9yQ29tcG9uZW50LFxyXG4gIFByb3RvYnVmQ29tcG9uZW50LFxyXG4gIFByb3h5Q29tcG9uZW50LFxyXG4gIFB1c2hTY2hlZHVsZXJDb21wb25lbnQsXHJcbiAgUmVtb3RlQ29tcG9uZW50LFxyXG4gIFNlcnZlckNvbXBvbmVudCxcclxuICBTZXNzaW9uQ29tcG9uZW50XHJcbn0gZnJvbSBcIi4vaW5kZXhcIjtcclxuY29uc3QgUGFja2FnZSA9IHJlcXVpcmUoXCIuLi9wYWNrYWdlXCIpO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBvbWVsbyB7XHJcbiAgcmVhZG9ubHkgdmVyc2lvbjogc3RyaW5nID0gUGFja2FnZS52ZXJzaW9uO1xyXG4gIHByaXZhdGUgX2NvbXBvbmVudHM6IFBvbWVsb0NvbXBvbmVudHM7XHJcbiAgcHJpdmF0ZSBfZmlsdGVyczogUG9tZWxvRmlsdGVycztcclxuICBwcml2YXRlIF9ycGNGaWx0ZXJzOiBQb21lbG9SUENGaWx0ZXJzO1xyXG4gIHByaXZhdGUgX2Nvbm5lY3RvcnM6IFBvbWVsb0Nvbm5lY3RvcnM7XHJcbiAgcHJpdmF0ZSBfcHVzaFNjaGVkdWxlcnM6IFBvbWVsb1B1c2hTY2hlZHVsZXJzO1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5fY29tcG9uZW50cyA9IHt9IGFzIFBvbWVsb0NvbXBvbmVudHM7XHJcbiAgICB0aGlzLl9maWx0ZXJzID0ge30gYXMgUG9tZWxvRmlsdGVycztcclxuICAgIHRoaXMuX3JwY0ZpbHRlcnMgPSB7fSBhcyBQb21lbG9SUENGaWx0ZXJzO1xyXG4gICAgdGhpcy5fY29ubmVjdG9ycyA9IHt9IGFzIFBvbWVsb0Nvbm5lY3RvcnM7XHJcbiAgICB0aGlzLl9wdXNoU2NoZWR1bGVycyA9IHt9IGFzIFBvbWVsb1B1c2hTY2hlZHVsZXJzO1xyXG5cclxuICAgIGZzLnJlYWRkaXJTeW5jKF9fZGlybmFtZSArIFwiL2NvbXBvbmVudHNcIikuZm9yRWFjaChmaWxlbmFtZSA9PiB7XHJcbiAgICAgIGlmICghL1xcLmpzJC8udGVzdChmaWxlbmFtZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgbGV0IG5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGVuYW1lLCBcIi5qc1wiKTtcclxuICAgICAgbGV0IF9sb2FkID0gbG9hZC5iaW5kKG51bGwsIFwiLi9jb21wb25lbnRzL1wiLCBuYW1lKTtcclxuXHJcbiAgICAgICg8YW55PnRoaXMuX2NvbXBvbmVudHMpLl9fZGVmaW5lR2V0dGVyX18obmFtZSwgX2xvYWQpO1xyXG4gICAgICAvLyg8YW55PnRoaXMpLl9fZGVmaW5lR2V0dGVyX18obmFtZSwgX2xvYWQpO1xyXG4gICAgfSk7XHJcbiAgICBmcy5yZWFkZGlyU3luYyhfX2Rpcm5hbWUgKyBcIi9maWx0ZXJzL2hhbmRsZXJcIikuZm9yRWFjaChmaWxlbmFtZSA9PiB7XHJcbiAgICAgIGlmICghL1xcLmpzJC8udGVzdChmaWxlbmFtZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgbGV0IG5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGVuYW1lLCBcIi5qc1wiKTtcclxuICAgICAgbGV0IF9sb2FkID0gbG9hZC5iaW5kKG51bGwsIFwiLi9maWx0ZXJzL2hhbmRsZXIvXCIsIG5hbWUpO1xyXG5cclxuICAgICAgKDxhbnk+dGhpcy5fZmlsdGVycykuX19kZWZpbmVHZXR0ZXJfXyhuYW1lLCBfbG9hZCk7XHJcbiAgICAgIC8vbW9kdWxlLmV4cG9ydHMuX19kZWZpbmVHZXR0ZXJfXyhuYW1lLCBfbG9hZCk7XHJcbiAgICB9KTtcclxuICAgIGZzLnJlYWRkaXJTeW5jKF9fZGlybmFtZSArIFwiL2ZpbHRlcnMvcnBjXCIpLmZvckVhY2goZmlsZW5hbWUgPT4ge1xyXG4gICAgICBpZiAoIS9cXC5qcyQvLnRlc3QoZmlsZW5hbWUpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBuYW1lID0gcGF0aC5iYXNlbmFtZShmaWxlbmFtZSwgXCIuanNcIik7XHJcbiAgICAgIGxldCBfbG9hZCA9IGxvYWQuYmluZChudWxsLCBcIi4vZmlsdGVycy9ycGMvXCIsIG5hbWUpO1xyXG5cclxuICAgICAgKDxhbnk+dGhpcy5fcnBjRmlsdGVycykuX19kZWZpbmVHZXR0ZXJfXyhuYW1lLCBfbG9hZCk7XHJcbiAgICB9KTtcclxuICAgICg8YW55PnRoaXMuX2Nvbm5lY3RvcnMpLl9fZGVmaW5lR2V0dGVyX18oXHJcbiAgICAgIFwic2lvY29ubmVjdG9yXCIsXHJcbiAgICAgIGxvYWQuYmluZChudWxsLCBcIi4vY29ubmVjdG9ycy9zaW9jb25uZWN0b3JcIilcclxuICAgICk7XHJcbiAgICAoPGFueT50aGlzLl9jb25uZWN0b3JzKS5fX2RlZmluZUdldHRlcl9fKFxyXG4gICAgICBcImh5YnJpZGNvbm5lY3RvclwiLFxyXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL2Nvbm5lY3RvcnMvaHlicmlkY29ubmVjdG9yXCIpXHJcbiAgICApO1xyXG4gICAgKDxhbnk+dGhpcy5fY29ubmVjdG9ycykuX19kZWZpbmVHZXR0ZXJfXyhcclxuICAgICAgXCJ1ZHBjb25uZWN0b3JcIixcclxuICAgICAgbG9hZC5iaW5kKG51bGwsIFwiLi9jb25uZWN0b3JzL3VkcGNvbm5lY3RvclwiKVxyXG4gICAgKTtcclxuICAgICg8YW55PnRoaXMuX2Nvbm5lY3RvcnMpLl9fZGVmaW5lR2V0dGVyX18oXHJcbiAgICAgIFwibXF0dGNvbm5lY3RvclwiLFxyXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL2Nvbm5lY3RvcnMvbXF0dGNvbm5lY3RvclwiKVxyXG4gICAgKTtcclxuICAgICg8YW55PnRoaXMuX3B1c2hTY2hlZHVsZXJzKS5fX2RlZmluZUdldHRlcl9fKFxyXG4gICAgICBcImRpcmVjdFwiLFxyXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL3B1c2hTY2hlZHVsZXJzL2RpcmVjdFwiKVxyXG4gICAgKTtcclxuICAgICg8YW55PnRoaXMuX3B1c2hTY2hlZHVsZXJzKS5fX2RlZmluZUdldHRlcl9fKFxyXG4gICAgICBcImJ1ZmZlclwiLFxyXG4gICAgICBsb2FkLmJpbmQobnVsbCwgXCIuL3B1c2hTY2hlZHVsZXJzL2J1ZmZlclwiKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldCBhcHAoKSB7XHJcbiAgICByZXR1cm4gQXBwbGljYXRpb24uaW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVBcHAob3B0cz86IGFueSkge1xyXG4gICAgdGhpcy5hcHAuaW5pdChvcHRzKTtcclxuICAgIHJldHVybiB0aGlzLmFwcDtcclxuICB9XHJcblxyXG4gIGdldCBjb21wb25lbnRzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NvbXBvbmVudHMgYXMgUmVhZG9ubHk8UG9tZWxvQ29tcG9uZW50cz47XHJcbiAgfVxyXG5cclxuICBnZXQgY29ubmVjdG9ycygpIHtcclxuICAgIHJldHVybiB0aGlzLl9jb25uZWN0b3JzIGFzIFJlYWRvbmx5PFBvbWVsb0Nvbm5lY3RvcnM+O1xyXG4gIH1cclxuICBnZXQgZmlsdGVycygpIHtcclxuICAgIHJldHVybiB0aGlzLl9maWx0ZXJzIGFzIFJlYWRvbmx5PFBvbWVsb0ZpbHRlcnM+O1xyXG4gIH1cclxuICBnZXQgcnBjRmlsdGVycygpIHtcclxuICAgIHJldHVybiB0aGlzLl9ycGNGaWx0ZXJzIGFzIFJlYWRvbmx5PFBvbWVsb1JQQ0ZpbHRlcnM+O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJhY2tlbmRTZXNzaW9uKCkge1xyXG4gICAgcmV0dXJuIGJhY2tlbmRTZXNzaW9uQ3RvcjtcclxuICB9XHJcbiAgZ2V0IGNoYW5uZWwoKSB7XHJcbiAgICByZXR1cm4gY2hhbm5lbEN0b3I7XHJcbiAgfVxyXG4gIGdldCBjb25uZWN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGNvbm5lY3Rpb25DdG9yO1xyXG4gIH1cclxuICBnZXQgY29ubmVjdG9yKCkge1xyXG4gICAgcmV0dXJuIGNvbm5lY3RvckN0b3I7XHJcbiAgfVxyXG4gIGdldCBkaWN0aW9uYXJ5KCkge1xyXG4gICAgcmV0dXJuIGRpY3Rpb25hcnlDdG9yO1xyXG4gIH1cclxuICBnZXQgbWFzdGVyKCkge1xyXG4gICAgcmV0dXJuIG1hc3RlckN0b3I7XHJcbiAgfVxyXG4gIGdldCBtb25pdG9yKCkge1xyXG4gICAgcmV0dXJuIG1vbml0b3JDdG9yO1xyXG4gIH1cclxuICBnZXQgcHJvdG9idWYoKSB7XHJcbiAgICByZXR1cm4gcHJvdG9idWZDdG9yO1xyXG4gIH1cclxuICBnZXQgcHJveHkoKSB7XHJcbiAgICByZXR1cm4gcHJveHlDdG9yO1xyXG4gIH1cclxuICBnZXQgcHVzaFNjaGVkdWxlcigpIHtcclxuICAgIHJldHVybiBwdXNoU2NoZWR1bGVyQ3RvcjtcclxuICB9XHJcbiAgZ2V0IHJlbW90ZSgpIHtcclxuICAgIHJldHVybiByZW1vdGVDdG9yO1xyXG4gIH1cclxuICBnZXQgc2VydmVyKCkge1xyXG4gICAgcmV0dXJuIHNlcnZlckN0b3I7XHJcbiAgfVxyXG4gIGdldCBzZXNzaW9uKCkge1xyXG4gICAgcmV0dXJuIHNlc3Npb25DdG9yO1xyXG4gIH1cclxuICBnZXQgdGltZW91dCgpIHtcclxuICAgIHJldHVybiB0aW1lb3V0Q3RvcjtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVtb3RlQWRkcmVzcyB7XHJcbiAgaXA6IHN0cmluZztcclxuICBwb3J0OiBzdHJpbmcgfCBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVNvY2tldCBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgcmVhZG9ubHkgaWQ6IG51bWJlcjtcclxuICByZWFkb25seSByZW1vdGVBZGRyZXNzOiBSZWFkb25seTxSZW1vdGVBZGRyZXNzPjtcclxuICBzZW5kKG1zZzogYW55KTogdm9pZDtcclxuICBkaXNjb25uZWN0KCk6IHZvaWQ7XHJcbiAgc2VuZEJhdGNoKG1zZ3M6IEFycmF5TGlrZTxhbnk+KTogdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQb21lbG9Db21wb25lbnRzIHtcclxuICByZWFkb25seSBiYWNrZW5kU2Vzc2lvbjogKGFwcDogQXBwbGljYXRpb24pID0+IEJhY2tlbmRTZXNzaW9uU2VydmljZTtcclxuICByZWFkb25seSBjaGFubmVsOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gQ2hhbm5lbFNlcnZpY2U7XHJcbiAgcmVhZG9ubHkgY29ubmVjdGlvbjogKGFwcDogQXBwbGljYXRpb24pID0+IENvbm5lY3Rpb25Db21wb25lbnQ7XHJcbiAgcmVhZG9ubHkgY29ubmVjdG9yOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gQ29ubmVjdG9yQ29tcG9uZW50O1xyXG4gIHJlYWRvbmx5IGRpY3Rpb25hcnk6IChhcHA6IEFwcGxpY2F0aW9uLCBvcHRzPzogb2JqZWN0KSA9PiBEaWN0aW9uYXJ5Q29tcG9uZW50O1xyXG4gIHJlYWRvbmx5IG1hc3RlcjogKGFwcDogQXBwbGljYXRpb24sIG9wdHM/OiBvYmplY3QpID0+IE1hc3RlckNvbXBvbmVudDtcclxuICByZWFkb25seSBtb25pdG9yOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gTW9uaXRvckNvbXBvbmVudDtcclxuICByZWFkb25seSBwcm90b2J1ZjogKGFwcDogQXBwbGljYXRpb24sIG9wdHM/OiBvYmplY3QpID0+IFByb3RvYnVmQ29tcG9uZW50O1xyXG4gIHJlYWRvbmx5IHByb3h5OiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gUHJveHlDb21wb25lbnQ7XHJcbiAgcmVhZG9ubHkgcHVzaFNjaGVkdWxlcjogKFxyXG4gICAgYXBwOiBBcHBsaWNhdGlvbixcclxuICAgIG9wdHM/OiBvYmplY3RcclxuICApID0+IFB1c2hTY2hlZHVsZXJDb21wb25lbnQ7XHJcbiAgcmVhZG9ubHkgcmVtb3RlOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gUmVtb3RlQ29tcG9uZW50O1xyXG4gIHJlYWRvbmx5IHNlcnZlcjogKGFwcDogQXBwbGljYXRpb24sIG9wdHM/OiBvYmplY3QpID0+IFNlcnZlckNvbXBvbmVudDtcclxuICByZWFkb25seSBzZXNzaW9uOiAoYXBwOiBBcHBsaWNhdGlvbiwgb3B0cz86IG9iamVjdCkgPT4gU2Vzc2lvbkNvbXBvbmVudDtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQb21lbG9GaWx0ZXJzIHt9XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBvbWVsb1JQQ0ZpbHRlcnMge31cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUG9tZWxvQ29ubmVjdG9ycyB7XHJcbiAgaHlicmlkY29ubmVjdG9yOiBIeWJyaWRDb25uZWN0b3I7XHJcbiAgc2lvY29ubmVjdG9yOiBTaW9Db25uZWN0b3I7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUG9tZWxvUHVzaFNjaGVkdWxlcnMge31cclxuXHJcbmZ1bmN0aW9uIGxvYWQocGF0aDogc3RyaW5nLCBuYW1lOiBzdHJpbmcpIHtcclxuICBsZXQgbW9kOiBhbnk7XHJcbiAgaWYgKG5hbWUpIHtcclxuICAgIG1vZCA9IHJlcXVpcmUocGF0aCArIG5hbWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBtb2QgPSByZXF1aXJlKHBhdGgpO1xyXG4gIH1cclxuICBpZiAobW9kICYmIG1vZC5kZWZhdWx0KSBtb2QgPSBtb2QuZGVmYXVsdDtcclxuICByZXR1cm4gbW9kO1xyXG59XHJcblxyXG5sZXQgcG9tZWxvID0gbmV3IFBvbWVsbygpO1xyXG5leHBvcnQgZGVmYXVsdCBwb21lbG87XHJcbiJdfQ==